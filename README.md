javascript:eval(atob('CS8qKgoJIgoJPG5hdiBjbGFzcz0ndXQtdGFiLWJhcic+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2JhY2tTbic+PHNwYW4+QXRyYXM8L3NwYW4+PC9idXR0b24+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2J1eU5vd1NuJz48c3Bhbj5Db21wcmEgeWE8L3NwYW4+PC9idXR0b24+Cgk8L25hdj4iCgoKCXZhciBzdHJpbmcgPSAiPG5hdiBjbGFzcz0ndXQtdGFiLWJhcic+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2JhY2tTbic+PHNwYW4+QXRyYXM8L3NwYW4+PC9idXR0b24+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2J1eU5vd1NuJz48c3Bhbj5Db21wcmEgeWE8L3NwYW4+PC9idXR0b24+PC9uYXY+IgoKCWZ1bmN0aW9uIG15RnVuY3Rpb24oKXsKCQlsZXQgZ290b05ld09mZmxpbmVQYWdlID0gaW5pdCgpWyIyIl07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJfQoKCgkkKGZ1bmN0aW9uKCl7CgkgIHZhciAkYnV0dG9uID0gJCgnLnV0LXRhYi1iYXInKS5jbG9uZSgpOwoJICAkYnV0dG9uLmVtcHR5KCkKCSAgJGJ1dHRvbi5hcHBlbmQoIjxidXR0b24gY2xhc3M9J3V0LXRhYi1iYXItaXRlbSAnIGlkPSdiYWNrU24nPjxzcGFuPkF0cmFzPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+Iik7CgkgICRidXR0b24uYXBwZW5kKCI8YnV0dG9uIGNsYXNzPSd1dC10YWItYmFyLWl0ZW0gJyBpZD0nYnV5Tm93U24nPjxzcGFuPkNvbXByYSB5YTwvc3Bhbj48L2J1dHRvbj4iKTsKCSAgJCgnLnV0LXRhYi1iYXInKS5iZWZvcmUoJGJ1dHRvbik7Cgl9KTsKCSovCgoKCgoJIWZ1bmN0aW9uIGphamEoZSkgewoJICBsZXQgJHNjb3BlID0gZSA9ICQuZXh0ZW5kKHsKCSAgICBiYWNrIDogNDksCgkgICAgZW5hYmxlRGlzYWJsZSA6IDkyLAoJICAgIGxpc3RzIDogewoJICAgICAgdXAgOiAzOCwKCSAgICAgIGRvd24gOiA0MCwKCSAgICAgIHByZXYgOiAzNywKCSAgICAgIG5leHQgOiAzOQoJICAgIH0sCgkgICAgc2VhcmNoIDogewoJICAgICAgZGVjTWluQmlkIDogMzcsCgkgICAgICBpbmNNaW5CaWQgOiAzOSwKCSAgICAgIGRlY01heEJpZCA6IDM1LAoJICAgICAgaW5jTWF4QmlkIDogMzYsCgkgICAgICBkZWNNaW5CdXkgOiA0NiwKCSAgICAgIGluY01pbkJ1eSA6IDM0LAoJICAgICAgZGVjTWF4QnV5IDogNDAsCgkgICAgICBpbmNNYXhCdXkgOiAzOCwKCSAgICAgIHNlYXJjaCA6IDUwCgkgICAgfSwKCSAgICByZXN1bHRzIDogewoJICAgICAgYmlkIDogNTIsCgkgICAgICBidXkgOiA1MSwKCSAgICAgIHRyYW5zZmVyIDogODIsCgkgICAgICBjbHViIDogNjcsCgkgICAgICBwcmVzc0VudGVyIDogdHJ1ZSwKCSAgICAgIGF1dG9CdXkgOiBmYWxzZSwKCSAgICAgIHByZXZlbnRCYWNrIDogZmFsc2UsCgkgICAgICBzZWxsIDogODEsCgkgICAgICBkZWNCaWQgOiA0NiwKCSAgICAgIGluY0JpZCA6IDM0CgkgICAgfQoJICB9LCBlIHx8IHt9KTsKCSAgdmFyICRidXR0b24gPSAkKCcudXQtdGFiLWJhcicpLmNsb25lKCk7CgkgICRidXR0b24uZW1wdHkoKQoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtJyBpZD0nYmFja1NuJyBzdHlsZT0nIGN1cnNvcjogcG9pbnRlcjsnPjxzcGFuPkF0cmFzPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtJyBpZD0nc2VhcmNoU24nIHN0eWxlPSdiYWNrZ3JvdW5kOiBvcmFuZ2U7IGN1cnNvcjogcG9pbnRlcjsnPjxzcGFuPkJ1c2Nhcjwvc3Bhbj48L2J1dHRvbj4iKTsKCSAgJGJ1dHRvbi5hcHBlbmQoIjxidXR0b24gY2xhc3M9J3V0LXRhYi1iYXItaXRlbScgaWQ9J2J1eU5vd1NuJyBzdHlsZT0nIGN1cnNvcjogcG9pbnRlcjsnPjxzcGFuPkNvbXByYSB5YTwvc3Bhbj48L2J1dHRvbj4iKTsKCSAgJCgnLnV0LW5hdmlnYXRpb24tY29udGFpbmVyLXZpZXcnKS5hZnRlcigkYnV0dG9uKTsKCSAgbGV0IGV2ZW50ID0gdHJ1ZTsKCSAgbGV0IGxhc3RGZXRjaFRpbWUgPSBuZXcgRGF0ZTsKCSAgbGV0IHMgPSBmYWxzZTsKCSAgLyoqIEB0eXBlIHtudW1iZXJ9ICovCgkgIHdpbmRvdy5NQVhfTkVXX0lURU1TID0gTnVtYmVyLk1BWF9WQUxVRTsKCSAgY29uc3QgSGFuID0gd2luZG93LnNlcnZpY2VzLkxvY2FsaXphdGlvbjsKCSAgY29uc3QgZGlzcGF0Y2hFdmVudCA9IChlbGVtLCB0eXBlKSA9PiB7CgkgICAgaWYgKDAgPT0gZWxlbS5sZW5ndGgpIHsKCSAgICAgIHJldHVybiBmYWxzZTsKCSAgICB9CgkgICAgY29uc3QgcmVwbGF5RXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgiTW91c2VFdmVudHMiKTsKCSAgICByZXR1cm4gcmVwbGF5RXZlbnQuaW5pdEV2ZW50KHR5cGUpLCBlbGVtWzBdLmRpc3BhdGNoRXZlbnQocmVwbGF5RXZlbnQpLCB0cnVlOwoJICB9OwoJICBjb25zdCBvayA9IChleHRyYSkgPT4gewoJICAgIHJldHVybiAoKGV2ZW50KSA9PiB7CgkgICAgICByZXR1cm4gZGlzcGF0Y2hFdmVudChldmVudCwgIm1vdXNlZG93biIpOwoJICAgIH0pKGV4dHJhKSAmJiAoKGV2ZW50KSA9PiB7CgkgICAgICByZXR1cm4gZGlzcGF0Y2hFdmVudChldmVudCwgIm1vdXNldXAiKTsKCSAgICB9KShleHRyYSk7CgkgIH07CgkgIGNvbnN0IHRyeVBhcnNlUVJDb2RlID0gKCkgPT4gewoJICAgIGxldCBpbnRlcnZhbEZ1bmN0aW9uQ2FsbGVkID0gJCgiLmRpYWxvZy1ib2R5IC51dC1idXR0b24tZ3JvdXAgYnV0dG9uOmVxKDApIik7CgkgICAgaWYgKG9rKGludGVydmFsRnVuY3Rpb25DYWxsZWQpKSB7CgkgICAgICAvKiogQHR5cGUge2Jvb2xlYW59ICovCgkgICAgICBzID0gZmFsc2U7CgkgICAgfSBlbHNlIHsKCSAgICAgIHNldFRpbWVvdXQodHJ5UGFyc2VRUkNvZGUsIDEwKTsKCSAgICB9CgkgIH07CgkgIGNvbnN0IGlubmVyVGltZXIgPSAoKSA9PiB7CgkgICAgaWYgKCEobmV3IERhdGUgLSBsYXN0RmV0Y2hUaW1lIDwgNTAwKSkgewoJICAgICAgLyoqIEB0eXBlIHshRGF0ZX0gKi8KCSAgICAgIGxhc3RGZXRjaFRpbWUgPSBuZXcgRGF0ZTsKCSAgICAgIGlmICghb2soJCgiLnV0LW5hdmlnYXRpb24tYnV0dG9uLWNvbnRyb2wiKSkpIHsKCSAgICAgICAgc2V0VGltZW91dChpbm5lclRpbWVyLCAxMCk7CgkgICAgICB9CgkgICAgfQoJICB9OwoJICBjb25zdCBpbml0ID0gKCkgPT4gewoJICAJY29uc29sZS5sb2coJ2FjYSB0YW1iaWVuJykKCSAgICBsZXQgb2JqID0ge307CgkgICAgaWYgKCQoIi5TZWFyY2hSZXN1bHRzIikubGVuZ3RoID4gMCAmJiAob2JqWyRzY29wZS5iYWNrXSA9ICgpID0+IHsKCSAgICAgIHJldHVybiBpbm5lclRpbWVyKCk7CgkgICAgfSksICQoIi51dC1tYXJrZXQtc2VhcmNoLWZpbHRlcnMtdmlldyIpLmxlbmd0aCA+IDApIHsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5kZWNNaW5CaWRdID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmRlY3JlbWVudC12YWx1ZSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guaW5jTWluQmlkXSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5pbmNyZW1lbnQtdmFsdWUiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmRlY01heEJpZF0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuZGVjcmVtZW50LXZhbHVlOmVxKDEpIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5pbmNNYXhCaWRdID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmluY3JlbWVudC12YWx1ZTplcSgxKSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guZGVjTWluQnV5XSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5kZWNyZW1lbnQtdmFsdWU6ZXEoMikiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmluY01pbkJ1eV0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuaW5jcmVtZW50LXZhbHVlOmVxKDIpIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5kZWNNYXhCdXldID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmRlY3JlbWVudC12YWx1ZTplcSgzKSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guaW5jTWF4QnV5XSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5pbmNyZW1lbnQtdmFsdWU6ZXEoMykiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLnNlYXJjaF0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuYnV0dG9uLWNvbnRhaW5lciAuYnRuLXN0YW5kYXJkLmNhbGwtdG8tYWN0aW9uIikpOwoJICAgICAgfTsKCSAgICB9IGVsc2UgewoJICAgICAgbGV0IG4gPSAkKCIubGlzdEZVVEl0ZW0iKTsKCSAgICAgIGxldCBpID0gbi5sZW5ndGggPiAwOwoJICAgICAgbGV0IHMgPSBuLnBhcmVudHMoIi5wYWdpbmF0ZWQsIC51dC13YXRjaC1saXN0LXZpZXcsIC51dC10cmFuc2Zlci1saXN0LXZpZXciKTsKCSAgICAgIGlmICgwID09IHMubGVuZ3RoKSB7CgkgICAgICAgIHMgPSBuLnBhcmVudCgpOwoJICAgICAgfQoJICAgICAgaWYgKGkgJiYgJCgiLkRldGFpbFBhbmVsID4gLmJpZE9wdGlvbnMiKS5sZW5ndGggPiAwKSB7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLnJlc3VsdHMuYmlkXSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soJCgiLmJpZEJ1dHRvbiIpKTsKCSAgICAgICAgfTsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUucmVzdWx0cy5idXldID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiB2b2lkKG9rKCQoIi5idXlCdXR0b24iKSkgJiYgJHNjb3BlLnJlc3VsdHMucHJlc3NFbnRlciAmJiB0cnlQYXJzZVFSQ29kZSgpKTsKCSAgICAgICAgfTsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUucmVzdWx0cy5kZWNCaWRdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygkKCIuYmlkT3B0aW9ucyAuZGVjcmVtZW50LXZhbHVlIikpOwoJICAgICAgICB9OwoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5yZXN1bHRzLmluY0JpZF0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCQoIi5iaWRPcHRpb25zIC5pbmNyZW1lbnQtdmFsdWUiKSk7CgkgICAgICAgIH07CgkgICAgICB9CgkgICAgICBpZiAoaSAmJiAkKCIuRGV0YWlsUGFuZWwgPiAudXQtYnV0dG9uLWdyb3VwIikubGVuZ3RoID4gMCkgewoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5yZXN1bHRzLnRyYW5zZmVyXSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soKCgpID0+IHsKCSAgICAgICAgICAgIHJldHVybiAkKGAudXQtYnV0dG9uLWdyb3VwID4gYnV0dG9uOmNvbnRhaW5zKCcke0hhbi5sb2NhbGl6ZSgiaW5mb3BhbmVsLmxhYmVsLnNlbmRUcmFkZVBpbGUiKX0nKWApOwoJICAgICAgICAgIH0pKCkpOwoJICAgICAgICB9OwoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5yZXN1bHRzLmNsdWJdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygoKCkgPT4gewoJICAgICAgICAgICAgcmV0dXJuICQoYC51dC1idXR0b24tZ3JvdXAgPiBidXR0b246Y29udGFpbnMoJyR7SGFuLmxvY2FsaXplKCJpbmZvcGFuZWwubGFiZWwuc3RvcmVJbkNsdWIiKX0nKWApOwoJICAgICAgICAgIH0pKCkpOwoJICAgICAgICB9OwoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5yZXN1bHRzLnNlbGxdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygoKCkgPT4gewoJICAgICAgICAgICAgcmV0dXJuICQoYC51dC1idXR0b24tZ3JvdXAgPiBidXR0b246Y29udGFpbnMoJyR7SGFuLmxvY2FsaXplKCJpbmZvcGFuZWwubGFiZWwuZGlzY2FyZCIpfScpYCk7CgkgICAgICAgICAgfSkoKSk7CgkgICAgICAgIH07CgkgICAgICB9CgkgICAgICBpZiAoaSkgewoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5saXN0cy51cF0gPSAoKSA9PiB7CgkgICAgICAgICAgbGV0ICRwYXJlbnQgPSBzOwoJICAgICAgICAgIGxldCB0ID0gJCgiLmxpc3RGVVRJdGVtLnNlbGVjdGVkIiwgJHBhcmVudCkucHJldigpOwoJICAgICAgICAgIG9rKHQpOwoJICAgICAgICAgICRwYXJlbnQuY3NzKCJwb3NpdGlvbiIsICJyZWxhdGl2ZSIpOwoJICAgICAgICAgICRwYXJlbnQuc2Nyb2xsVG9wKCRwYXJlbnQuc2Nyb2xsVG9wKCkgKyB0LnBvc2l0aW9uKCkudG9wIC0gdC5oZWlnaHQoKSk7CgkgICAgICAgIH07CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLmxpc3RzLmRvd25dID0gKCkgPT4gewoJICAgICAgICAgIGxldCAkcGFyZW50ID0gczsKCSAgICAgICAgICBsZXQgaW50ZXJ2YWxGdW5jdGlvbkNhbGxlZCA9ICQoIi5saXN0RlVUSXRlbS5zZWxlY3RlZCIsICRwYXJlbnQpLm5leHQoKTsKCSAgICAgICAgICBvayhpbnRlcnZhbEZ1bmN0aW9uQ2FsbGVkKTsKCSAgICAgICAgICAkcGFyZW50LmNzcygicG9zaXRpb24iLCAicmVsYXRpdmUiKTsKCSAgICAgICAgICAkcGFyZW50LnNjcm9sbFRvcCgkcGFyZW50LnNjcm9sbFRvcCgpICsgaW50ZXJ2YWxGdW5jdGlvbkNhbGxlZC5wb3NpdGlvbigpLnRvcCk7CgkgICAgICAgIH07CgkgICAgICB9CgkgICAgICBpZiAoJCgiLnBhZ2luZ0NvbnRhaW5lciIpLmxlbmd0aCA+IDApIHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUubGlzdHMucHJldl0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCQoIi5wYWdpbmdDb250YWluZXIgLnByZXY6dmlzaWJsZSIpKTsKCSAgICAgICAgfTsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUubGlzdHMubmV4dF0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCQoIi5wYWdpbmdDb250YWluZXIgLm5leHQ6dmlzaWJsZSIpKTsKCSAgICAgICAgfTsKCSAgICAgIH0KCSAgICB9CgkgICAgcmV0dXJuIG9iajsKCSAgfTsKCSAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgKG9iaikgPT4gewoJICAgIGlmIChvYmoua2V5Q29kZSA9PSAkc2NvcGUuZW5hYmxlRGlzYWJsZSAmJiAoZXZlbnQgPSAhZXZlbnQpLCAhZXZlbnQpIHsKCSAgICAgIHJldHVybjsKCSAgICB9CgkgICAgY29uc29sZS5sb2cob2JqLmtleUNvZGUpCgkgICAgbGV0IGdvdG9OZXdPZmZsaW5lUGFnZSA9IGluaXQoKVtvYmoua2V5Q29kZV07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJICB9KTsKCSAgY29uc29sZS5sb2coIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWFyY2hTbiIpKQoJICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VhcmNoU24iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkgIAljb25zb2xlLmxvZygiZW50cmUiKQoJICAJZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlYXJjaFNuIikuc3R5bGUuYmFja2dyb3VuZENvbG9yPSdyZWQnCgkgIAlsZXQgZ290b05ld09mZmxpbmVQYWdlID0gaW5pdCgpWzM5XTsKCSAgICBpZiAoZ290b05ld09mZmxpbmVQYWdlKSB7CgkgICAgICBnb3RvTmV3T2ZmbGluZVBhZ2UoKTsKCSAgICB9CgkgIAlsZXQgZ290b05ld09mZmxpbmVQYWdlMiA9IGluaXQoKVs1MF07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZTIpIHsKCSAgICAgIGdvdG9OZXdPZmZsaW5lUGFnZTIoKTsKCSAgICB9CgkgIH0pCgkgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJiYWNrU24iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkgIAljb25zb2xlLmxvZygiZW50cmUiKQoJICAJCgkgIAlsZXQgZ290b05ld09mZmxpbmVQYWdlID0gaW5pdCgpWzQ5XTsKCSAgICBpZiAoZ290b05ld09mZmxpbmVQYWdlKSB7CgkgICAgICBnb3RvTmV3T2ZmbGluZVBhZ2UoKTsKCSAgICB9CgkgIH0pCgkgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJidXlOb3dTbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKXsKCSAgCWNvbnNvbGUubG9nKCJlbnRyZSIpCgkgIAlsZXQgZ290b05ld09mZmxpbmVQYWdlID0gaW5pdCgpWzUxXTsKCSAgICBpZiAoZ290b05ld09mZmxpbmVQYWdlKSB7CgkgICAgICBnb3RvTmV3T2ZmbGluZVBhZ2UoKTsKCSAgICB9CgkgIH0pCgl9KHsKCSAgImJhY2siIDogNDksCgkgICJlbmFibGVEaXNhYmxlIiA6IDE4OCwKCSAgInRlY2giIDogODQsCgkgICJsaXN0cyIgOiB7CgkgICAgInVwIiA6IDM4LAoJICAgICJkb3duIiA6IDQwLAoJICAgICJwcmV2IiA6IDM3LAoJICAgICJuZXh0IiA6IDM5CgkgIH0sCgkgICJzZWFyY2giIDogewoJICAgICJkZWNNaW5CaWQiIDogMzcsCgkgICAgImluY01pbkJpZCIgOiAzOSwKCSAgICAiZGVjTWF4QmlkIiA6IDM1LAoJICAgICJpbmNNYXhCaWQiIDogMzYsCgkgICAgImRlY01pbkJ1eSIgOiA0NiwKCSAgICAiaW5jTWluQnV5IiA6IDM0LAoJICAgICJkZWNNYXhCdXkiIDogNDAsCgkgICAgImluY01heEJ1eSIgOiAzOCwKCSAgICAic2VhcmNoIiA6IDUwCgkgIH0sCgkgICJyZXN1bHRzIiA6IHsKCSAgICAiYmlkIiA6IDUyLAoJICAgICJidXkiIDogNTEsCgkgICAgInRyYW5zZmVyIiA6IDgyLAoJICAgICJjbHViIiA6IDY3LAoJICAgICJwcmVzc0VudGVyIiA6IHRydWUsCgkgICAgImF1dG9CdXkiIDogZmFsc2UsCgkgICAgInByZXZlbnRCYWNrIiA6IHRydWUsCgkgICAgInNlbGwiIDogODEsCgkgICAgImRlY0JpZCIgOiA0NiwKCSAgICAiaW5jQmlkIiA6IDM0CgkgIH0KCX0pOwoKCgoKCgoKClVUTWFya2V0U2VhcmNoUmVzdWx0c1ZpZXdDb250cm9sbGVyLnByb3RvdHlwZS5fcmVxdWVzdEl0ZW1zID0gZnVuY3Rpb24gX3JlcXVlc3RJdGVtcyhsKSB7CiAgICB0aGlzLl9wYWdpbmF0aW9uVmlld01vZGVsLnN0b3BBdWN0aW9uVXBkYXRlcygpOwogICAgaWYodGhpcy5fc2VhcmNoQ3JpdGVyaWEuX3R5cGUgPT0gInBsYXllciIpewogICAgICAgIHZhciBjb250ZXh0ID0gdGhpczsKCiAgICAgICAgcmVxdWVzdEl0ZW1zKCkKICAgIH0gZWxzZSB7CiAgICAgICAgc2VydmljZXMuSXRlbS5zZWFyY2hUcmFuc2Zlck1hcmtldCh0aGlzLl9zZWFyY2hDcml0ZXJpYSwgbCkub2JzZXJ2ZSh0aGlzLCBmdW5jdGlvbiBfb25SZXF1ZXN0SXRlbXNDb21wbGV0ZShlLCB0KSB7CiAgICAgICAgICAgIGlmIChlLnVub2JzZXJ2ZSh0aGlzKSwKICAgICAgICAgICAgIXQuc3VjY2VzcykKICAgICAgICAgICAgICAgIHJldHVybiBOZXR3b3JrRXJyb3JNYW5hZ2VyLmNoZWNrQ3JpdGljYWxTdGF0dXModC5zdGF0dXMpID8gdm9pZCBOZXR3b3JrRXJyb3JNYW5hZ2VyLmhhbmRsZVN0YXR1cyh0LnN0YXR1cykgOiAoc2VydmljZXMuTm90aWZpY2F0aW9uLnF1ZXVlKFtzZXJ2aWNlcy5Mb2NhbGl6YXRpb24ubG9jYWxpemUoInBvcHVwLmVycm9yLnNlYXJjaGVycm9yIiksIGVudW1zLlVJTm90aWZpY2F0aW9uVHlwZS5ORUdBVElWRV0pLAogICAgICAgICAgICAgICAgdm9pZCB0aGlzLmdldE5hdmlnYXRpb25Db250cm9sbGVyKCkucG9wVmlld0NvbnRyb2xsZXIoKSk7CiAgICAgICAgICAgIGlmICgwIDwgdGhpcy5fc2VhcmNoQ3JpdGVyaWEub2Zmc2V0ICYmIDAgPT09IHQuZGF0YS5pdGVtcy5sZW5ndGgpCiAgICAgICAgICAgICAgICB0aGlzLl9yZXF1ZXN0SXRlbXMobCAtIDEpOwogICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBpID0gdGhpcy5fcGFnaW5hdGlvblZpZXdNb2RlbC5nZXROdW1JdGVtc1BlclBhZ2UoKQogICAgICAgICAgICAgICAgdmFyIG8gPSB0LmRhdGEuaXRlbXMuc2xpY2UoKTsKICAgICAgICAgICAgICAgIHNldEl0ZW1zKHRoaXMsbyxpLHQuZGF0YS5pdGVtcykKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLl9wYWdpbmF0aW9uVmlld01vZGVsLnN0YXJ0QXVjdGlvblVwZGF0ZXMoKQogICAgICAgIH0pCiAgICB9CgogICAgZnVuY3Rpb24gdXBkYXRlKGRhdGEsY29udGV4dCkgewogICAgICAgIFVUSXRlbUVudGl0eUZhY3RvcnkucHJvdG90eXBlLmF1Y3Rpb25GYWN0b3J5ID0gbmV3IFVUQXVjdGlvbkVudGl0eUZhY3RvcnkoKQogICAgICAgIHZhciBpID0gY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5nZXROdW1JdGVtc1BlclBhZ2UoKQogICAgICAgIHZhciBvID0gVVRJdGVtRW50aXR5RmFjdG9yeS5wcm90b3R5cGUuZ2VuZXJhdGVJdGVtc0Zyb21BdWN0aW9uRGF0YShkYXRhLmF1Y3Rpb25JbmZvKQogICAgICAgIGlmICgwIDwgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEub2Zmc2V0ICYmIDAgPT09IGRhdGEuYXVjdGlvbkluZm8ubGVuZ3RoKQogICAgICAgICAgICAgICAgY29udGV4dC5fcmVxdWVzdEl0ZW1zKGwgLSAxKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgICBzZXRJdGVtcyhjb250ZXh0LG8saSxkYXRhLmF1Y3Rpb25JbmZvKQogICAgICAgIH0KICAgICAgICBjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLnN0YXJ0QXVjdGlvblVwZGF0ZXMoKSAgIAogICAgfQoKICAgIGZ1bmN0aW9uIGFkZEZpbHRlcnMoY29udGV4dCx1cmwpewogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnJhcml0aWVzLmxlbmd0aD4wKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZyYXJpdHlJZHM9Iitjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5yYXJpdGllc1swXSAgICAKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubmF0aW9uIT0tMSl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbmF0PSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm5hdGlvbgogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5sZXZlbCE9ImFueSIpewogICAgICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5sZXZlbCA9PSAiU1AiKXsKICAgICAgICAgICAgICAgIHVybCA9IHVybCArICImcmFyZT0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5sZXZlbAogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdXJsID0gdXJsICsgIiZsZXY9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubGV2ZWwKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5jbHViIT0tMSl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImdGVhbT0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5jbHViCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLl96b25lIT0tMSl7CiAgICAgICAgICAgIHZhciB6b25lcyA9IHsKICAgICAgICAgICAgICAgICIxMzAiOiAiZGVmZW5zZSIsCiAgICAgICAgICAgICAgICAiMTMxIjogIm1pZGZpZWxkIiwKICAgICAgICAgICAgICAgICIxMzIiOiAiYXR0YWNrZXIiIAogICAgICAgICAgICB9CiAgICAgICAgICAgIHVybCA9IHVybCArICImem9uZT0iKyB6b25lc1tjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5fem9uZV0KICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEucG9zaXRpb24hPSJhbnkiKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZwb3M9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEucG9zaXRpb24KICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWFza2VkRGVmSWQpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJm1hc2tlZERlZklkPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1hc2tlZERlZklkCiAgICAgICAgfSAgICAKICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5sZWFndWUhPS0xKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZsZWFnPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmxlYWd1ZQogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5wbGF5U3R5bGUhPS0xKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZwbGF5U3R5bGU9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEucGxheVN0eWxlCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1pbkJ1eSl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbWluYj0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5taW5CdXkKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWF4QnV5KXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZtYXhiPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1heEJ1eQogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5taW5CaWQpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJm1pY3I9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWluQmlkCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1pbkJpZCl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbWljcj0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5taW5CaWQKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWF4QmlkKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZtYWNyPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1heEJpZAogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5kZWZJZC5sZW5ndGg+MCl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImZGVmaW5pdGlvbklkPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmRlZklkWzBdCiAgICAgICAgfQogICAgICAgIHJldHVybiB1cmwKICAgIH0KCiAgICBmdW5jdGlvbiByZXF1ZXN0SXRlbXMoKXsKICAgICAgICB2YXIgdXJsID0gYCR7c2VydmljZXMuQXV0aGVudGljYXRpb24uc2Vzc2lvblV0YXMudXJsfS91dC9nYW1lL2ZpZmEyMS90cmFuc2Zlcm1hcmtldD9udW09MjEmc3RhcnQ9JHsobC0xKSoyMH0mdHlwZT1wbGF5ZXJgOwogICAgICAgIHVybCA9IGFkZEZpbHRlcnMoY29udGV4dCx1cmwpCiAgICAgICAgZmV0Y2godXJsLCB7CiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgIlgtVVQtU0lEIjogc2VydmljZXMuQXV0aGVudGljYXRpb24uZ2V0VXRhc1Nlc3Npb24oKVsiaWQiXQogICAgICAgIH19KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKSB7CiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICAgIHVwZGF0ZShkYXRhLGNvbnRleHQpICAgICAgICAgICAgIAogICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKXsKICAgICAgICAgICAgc2VydmljZXMuTm90aWZpY2F0aW9uLnF1ZXVlKFtzZXJ2aWNlcy5Mb2NhbGl6YXRpb24ubG9jYWxpemUoInBvcHVwLmVycm9yLnNlYXJjaGVycm9yIiksZW51bXMuVUlOb3RpZmljYXRpb25UeXBlLk5FR0FUSVZFXSkKICAgICAgICAgICAgdm9pZCBjb250ZXh0LmdldE5hdmlnYXRpb25Db250cm9sbGVyKCkucG9wVmlld0NvbnRyb2xsZXIoKTsKICAgICAgICB9KQogICAgfQoKICAgIGZ1bmN0aW9uIHNldEl0ZW1zKGNvbnRleHQsbyxpLHJlc3BvbnNlSXRlbXMpewogICAgICAgIGlmIChjb250ZXh0Lm9uRGF0YUNoYW5nZS5ub3RpZnkoewogICAgICAgICAgICBpdGVtczogbwogICAgICAgIH0pLAogICAgICAgIG8ubGVuZ3RoID4gaSAmJiAobyA9IG8uc2xpY2UoMCwgaSkpLAogICAgICAgIGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuc2V0UGFnZUl0ZW1zKG8pLAogICAgICAgIGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuc2V0UGFnZUluZGV4KGwpLAogICAgICAgIGNvbnRleHQuX3NlbGVjdGVkSXRlbSAmJiAwIDwgby5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIG4gPSBjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLmdldEluZGV4QnlJdGVtSWQoY29udGV4dC5fc2VsZWN0ZWRJdGVtLmlkKTsKICAgICAgICAgICAgMCA8IG4gJiYgY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5zZXRJbmRleChuKSwKICAgICAgICAgICAgY29udGV4dC5fc2VsZWN0ZWRJdGVtID0gbnVsbAogICAgICAgIH0KICAgICAgICB2YXIgcyA9IGNvbnRleHQuZ2V0VmlldygpCiAgICAgICAgICAsIHIgPSBudWxsOwogICAgICAgIGlmICghY29udGV4dC5fc3RhZGl1bVZpZXdtb2RlbCB8fCBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS50eXBlICE9PSBTZWFyY2hUeXBlLlZBTklUWSAmJiBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS50eXBlICE9PSBTZWFyY2hUeXBlLkNMVUJfSU5GTyAmJiBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS50eXBlICE9PSBTZWFyY2hUeXBlLkJBTEwgfHwgKHIgPSBjb250ZXh0Ll9zdGFkaXVtVmlld21vZGVsLmdldFN0YWRpdW1Qcm9ncmVzc2lvbihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5zdWJ0eXBlcykpLAogICAgICAgIHMuc2V0SXRlbXMoY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5nZXRDdXJyZW50UGFnZUl0ZW1zKCksIHIpLAogICAgICAgIHMuc2V0UGFnaW5hdGlvblN0YXRlKDEgPCBsLCByZXNwb25zZUl0ZW1zLmxlbmd0aCA+IGkpLAogICAgICAgIEpTVXRpbHMuaXNWYWxpZChjb250ZXh0Ll9jb21wYXJlSXRlbSkgJiYgIWNvbnRleHQuX3NxdWFkQ29udGV4dCkgewogICAgICAgICAgICB2YXIgYSA9IEpTVXRpbHMuZmluZChvLCBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZS5nZXRBdWN0aW9uRGF0YSgpLnRyYWRlSWQgPT09IGNvbnRleHQuX2NvbXBhcmVJdGVtLmdldEF1Y3Rpb25EYXRhKCkudHJhZGVJZAogICAgICAgICAgICB9CiAgICAgICAgICAgIC5iaW5kKGNvbnRleHQpKTsKICAgICAgICAgICAgSlNVdGlscy5pc1ZhbGlkKGEpID8gY29udGV4dC5fcGlubmVkTGlzdEl0ZW0uc2V0SXRlbShhKSA6IGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuc2V0UGlubmVkSXRlbShjb250ZXh0Ll9jb21wYXJlSXRlbSkKICAgICAgICB9IGVsc2UKICAgICAgICAgICAgIWlzUGhvbmUoKSAmJiAwIDwgby5sZW5ndGggJiYgcy5zZWxlY3RMaXN0Um93KGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuZ2V0Q3VycmVudEl0ZW0oKS5pZCkKICAgIH0KfQoKCmFjY2Vzc29iamVjdHMuQ2x1Yi5nZXRVcmxQYXJhbXMgPSBmdW5jdGlvbihzZWFyY2hDcml0ZXJpYSkgewogICAgdmFyIGNyaXRlcmlhID0ge307CiAgICBjcml0ZXJpYS50eXBlID0gc2VhcmNoQ3JpdGVyaWEudHlwZSA9PT0gU2VhcmNoVHlwZS5BTlkgPyBTZWFyY2hUeXBlLlBMQVlFUiA6IHNlYXJjaENyaXRlcmlhLnR5cGUsCiAgICBjcml0ZXJpYS5zdGFydCA9IHNlYXJjaENyaXRlcmlhLm9mZnNldCwKICAgIGNyaXRlcmlhLmNvdW50ID0gc2VhcmNoQ3JpdGVyaWEuY291bnQ7CiAgICB2YXIgZm9ybWVkQ3JpdGVyaWEgPSBjcml0ZXJpYTsKICAgIHNlYXJjaENyaXRlcmlhLnNvcnRCeSA9PT0gU2VhcmNoU29ydFR5cGUuUkVDRU5DWSA/IGZvcm1lZENyaXRlcmlhLmFjcXVpcmVkRGF0ZSA9IHNlYXJjaENyaXRlcmlhLnNvcnQgOiAoZm9ybWVkQ3JpdGVyaWEuc29ydCA9IHNlYXJjaENyaXRlcmlhLnNvcnQsCiAgICBmb3JtZWRDcml0ZXJpYS5zb3J0ICE9PSBTZWFyY2hTb3J0T3JkZXIuTk9ORSAmJiAoZm9ybWVkQ3JpdGVyaWEuc29ydEJ5ID0gc2VhcmNoQ3JpdGVyaWEuc29ydEJ5KSk7CiAgICBpZiAoc2VhcmNoQ3JpdGVyaWEudHlwZSA9PT0gU2VhcmNoVHlwZS5WQU5JVFkpCiAgICAgICAgZm9ybWVkQ3JpdGVyaWEudmFuaXR5U3ViVHlwZUlkcyA9IHNlYXJjaENyaXRlcmlhLnN1YnR5cGVzOwogICAgZWxzZQogICAgICAgIHNlYXJjaENyaXRlcmlhLmNhdGVnb3J5ICE9PSBTZWFyY2hDYXRlZ29yeS5BTlkgJiYgKGZvcm1lZENyaXRlcmlhLnR5cGUgPSBzZWFyY2hDcml0ZXJpYS5jYXRlZ29yeS50b0xvd2VyQ2FzZSgpKTsKICAgIGlmIChzZWFyY2hDcml0ZXJpYS5yYXJpdGllcy5sZW5ndGggPiAwKQogICAgICAgIGZvcm1lZENyaXRlcmlhLnJhcml0eUlkcyA9IHNlYXJjaENyaXRlcmlhLnJhcml0aWVzLmpvaW4oJywnKTsKICAgIGlmIChzZWFyY2hDcml0ZXJpYS5sZXZlbCA9PT0gZW51bXMuU2VhcmNoTGV2ZWwuU1BFQ0lBTCkKICAgICAgICBmb3JtZWRDcml0ZXJpYS5yYXJlID0gc2VhcmNoQ3JpdGVyaWEubGV2ZWw7CiAgICBlbHNlCiAgICAgICAgc2VhcmNoQ3JpdGVyaWEubGV2ZWwgIT09IGVudW1zLlNlYXJjaExldmVsLkFOWSAmJiAoZm9ybWVkQ3JpdGVyaWEubGV2ZWwgPSBzZWFyY2hDcml0ZXJpYS5sZXZlbCk7CiAgICBzZWFyY2hDcml0ZXJpYS5jbHViID4gMCAmJiAoZm9ybWVkQ3JpdGVyaWEudGVhbSA9IHNlYXJjaENyaXRlcmlhLmNsdWIpOwogICAgc2VhcmNoQ3JpdGVyaWEubGVhZ3VlID4gMCAmJiAoZm9ybWVkQ3JpdGVyaWEubGVhZ3VlID0gc2VhcmNoQ3JpdGVyaWEubGVhZ3VlKTsKICAgIHNlYXJjaENyaXRlcmlhLm5hdGlvbiA+IDAgJiYgKGZvcm1lZENyaXRlcmlhLm5hdGlvbiA9IHNlYXJjaENyaXRlcmlhLm5hdGlvbik7CiAgICBzZWFyY2hDcml0ZXJpYS51bnRyYWRlYWJsZXMgIT09IGVudW1zLlNlYXJjaFVudHJhZGVhYmxlcy5ERUZBVUxUICYmIChmb3JtZWRDcml0ZXJpYS5pc1VudHJhZGVhYmxlID0gc2VhcmNoQ3JpdGVyaWEudW50cmFkZWFibGVzKTsKICAgIHNlYXJjaENyaXRlcmlhLmV4Y2x1ZGVEZWZJZHMubGVuZ3RoID4gMCAmJiAoZm9ybWVkQ3JpdGVyaWEuZXhjbGRlZiA9IHNlYXJjaENyaXRlcmlhLmV4Y2x1ZGVEZWZJZHMuam9pbignLCcpKTsKICAgIHNlYXJjaENyaXRlcmlhLmlzRXhhY3RTZWFyY2ggJiYgKGZvcm1lZENyaXRlcmlhLmZpbHRlciA9ICJleGFjdCIpOwogICAgaWYgKHNlYXJjaENyaXRlcmlhLnpvbmUgIT09IC0xKQogICAgICAgIHN3aXRjaCAoc2VhcmNoQ3JpdGVyaWEuem9uZSkgewogICAgICAgIGNhc2UgWk9ORV9ERUZFTkRFUl9WQUxVRToKICAgICAgICAgICAgZm9ybWVkQ3JpdGVyaWFbInR5cGUiXSA9ICJwbGF5ZXJkZWZlbmRlciI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgWk9ORV9NSURGSUVMREVSX1ZBTFVFOgogICAgICAgICAgICBmb3JtZWRDcml0ZXJpYVsidHlwZSJdID0gInBsYXllcm1pZGZpZWxkZXIiOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFpPTkVfQVRUQUNLRVJfVkFMVUU6CiAgICAgICAgICAgIGZvcm1lZENyaXRlcmlhWyJ0eXBlIl0gPSAicGxheWVyZm9yd2FyZCI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgWk9ORV9OT19HS19WQUxVRToKICAgICAgICAgICAgZm9ybWVkQ3JpdGVyaWFbInR5cGUiXSA9ICJwbGF5ZXJub25HSyI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIERlYnVnVXRpbHMuQXNzZXJ0KCFbXSwgIlVuc3VwcG9ydGVkIHpvbmUgSUQgaW4gY2x1YiBzZWFyY2guIik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgIGVsc2UKICAgICAgICBzZWFyY2hDcml0ZXJpYS5wb3NpdGlvbiAhPT0gU2VhcmNoVHlwZVsiQU5ZIl0gJiYgKGZvcm1lZENyaXRlcmlhLnBvc2l0aW9uID0gc2VhcmNoQ3JpdGVyaWEucG9zaXRpb24pOwogICAgcmV0dXJuIHNlYXJjaENyaXRlcmlhLnBsYXlTdHlsZSA+IDAgJiYgKGZvcm1lZENyaXRlcmlhLnBsYXlTdHlsZSA9IHNlYXJjaENyaXRlcmlhLnBsYXlTdHlsZSksCiAgICBzZWFyY2hDcml0ZXJpYS5oYXNWYWxpZERlZklkKCkgJiYgKGZvcm1lZENyaXRlcmlhLmRlZklkID0gc2VhcmNoQ3JpdGVyaWEuZGVmSWQuam9pbignLCcpKSwKICAgIGZvcm1lZENyaXRlcmlhOwp9'))
