javascript:eval(atob('CS8qKgoJIgoJPG5hdiBjbGFzcz0ndXQtdGFiLWJhcic+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2JhY2tTbic+PHNwYW4+QXRyYXM8L3NwYW4+PC9idXR0b24+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2J1eU5vd1NuJz48c3Bhbj5Db21wcmEgeWE8L3NwYW4+PC9idXR0b24+Cgk8L25hdj4iCgoKCXZhciBzdHJpbmcgPSAiPG5hdiBjbGFzcz0ndXQtdGFiLWJhcic+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2JhY2tTbic+PHNwYW4+QXRyYXM8L3NwYW4+PC9idXR0b24+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2J1eU5vd1NuJz48c3Bhbj5Db21wcmEgeWE8L3NwYW4+PC9idXR0b24+PC9uYXY+IgoKCWZ1bmN0aW9uIG15RnVuY3Rpb24oKXsKCQlsZXQgZ290b05ld09mZmxpbmVQYWdlID0gaW5pdCgpWyIyIl07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJfQoKCgkkKGZ1bmN0aW9uKCl7CgkgIHZhciAkYnV0dG9uID0gJCgnLnV0LXRhYi1iYXInKS5jbG9uZSgpOwoJICAkYnV0dG9uLmVtcHR5KCkKCSAgJGJ1dHRvbi5hcHBlbmQoIjxidXR0b24gY2xhc3M9J3V0LXRhYi1iYXItaXRlbSAnIGlkPSdiYWNrU24nPjxzcGFuPkF0cmFzPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+Iik7CgkgICRidXR0b24uYXBwZW5kKCI8YnV0dG9uIGNsYXNzPSd1dC10YWItYmFyLWl0ZW0gJyBpZD0nYnV5Tm93U24nPjxzcGFuPkNvbXByYSB5YTwvc3Bhbj48L2J1dHRvbj4iKTsKCSAgJCgnLnV0LXRhYi1iYXInKS5iZWZvcmUoJGJ1dHRvbik7Cgl9KTsKCSovCgoKCgoJIWZ1bmN0aW9uIGphamEoZSkgewoJICBsZXQgJHNjb3BlID0gZSA9ICQuZXh0ZW5kKHsKCSAgICBiYWNrIDogNDksCgkgICAgZW5hYmxlRGlzYWJsZSA6IDkyLAoJICAgIGxpc3RzIDogewoJICAgICAgdXAgOiAzOCwKCSAgICAgIGRvd24gOiA0MCwKCSAgICAgIHByZXYgOiAzNywKCSAgICAgIG5leHQgOiAzOQoJICAgIH0sCgkgICAgc2VhcmNoIDogewoJICAgICAgZGVjTWluQmlkIDogMzcsCgkgICAgICBpbmNNaW5CaWQgOiAzOSwKCSAgICAgIGRlY01heEJpZCA6IDM1LAoJICAgICAgaW5jTWF4QmlkIDogMzYsCgkgICAgICBkZWNNaW5CdXkgOiA0NiwKCSAgICAgIGluY01pbkJ1eSA6IDM0LAoJICAgICAgZGVjTWF4QnV5IDogNDAsCgkgICAgICBpbmNNYXhCdXkgOiAzOCwKCSAgICAgIHNlYXJjaCA6IDUwCgkgICAgfSwKCSAgICByZXN1bHRzIDogewoJICAgICAgYmlkIDogNTIsCgkgICAgICBidXkgOiA1MSwKCSAgICAgIHRyYW5zZmVyIDogODIsCgkgICAgICBjbHViIDogNjcsCgkgICAgICBwcmVzc0VudGVyIDogdHJ1ZSwKCSAgICAgIGF1dG9CdXkgOiBmYWxzZSwKCSAgICAgIHByZXZlbnRCYWNrIDogZmFsc2UsCgkgICAgICBzZWxsIDogODEsCgkgICAgICBkZWNCaWQgOiA0NiwKCSAgICAgIGluY0JpZCA6IDM0CgkgICAgfQoJICB9LCBlIHx8IHt9KTsKCSAgdmFyICRidXR0b24gPSAkKCcudXQtdGFiLWJhcicpLmNsb25lKCk7CgkgICRidXR0b24uZW1wdHkoKQoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtJyBpZD0nYmFja1NuJyBzdHlsZT0nIGN1cnNvcjogcG9pbnRlcjsnPjxzcGFuPkF0cmFzPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtJyBpZD0nc2VhcmNoU24nIHN0eWxlPSdiYWNrZ3JvdW5kOiBvcmFuZ2U7IGN1cnNvcjogcG9pbnRlcjsnIG9uY2xpY2s9J2hvbGEoKSc+PHNwYW4+QnVzY2FyPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtJyBpZD0nYnV5Tm93U24nIHN0eWxlPScgY3Vyc29yOiBwb2ludGVyOyc+PHNwYW4+Q29tcHJhIHlhPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkKCcudXQtbmF2aWdhdGlvbi1jb250YWluZXItdmlldycpLmFmdGVyKCRidXR0b24pOwoJICBsZXQgZXZlbnQgPSB0cnVlOwoJICBsZXQgbGFzdEZldGNoVGltZSA9IG5ldyBEYXRlOwoJICBsZXQgcyA9IGZhbHNlOwoJICAvKiogQHR5cGUge251bWJlcn0gKi8KCSAgd2luZG93Lk1BWF9ORVdfSVRFTVMgPSBOdW1iZXIuTUFYX1ZBTFVFOwoJICBjb25zdCBIYW4gPSB3aW5kb3cuc2VydmljZXMuTG9jYWxpemF0aW9uOwoJICBjb25zdCBkaXNwYXRjaEV2ZW50ID0gKGVsZW0sIHR5cGUpID0+IHsKCSAgICBpZiAoMCA9PSBlbGVtLmxlbmd0aCkgewoJICAgICAgcmV0dXJuIGZhbHNlOwoJICAgIH0KCSAgICBjb25zdCByZXBsYXlFdmVudCA9IGRvY3VtZW50LmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50cyIpOwoJICAgIHJldHVybiByZXBsYXlFdmVudC5pbml0RXZlbnQodHlwZSksIGVsZW1bMF0uZGlzcGF0Y2hFdmVudChyZXBsYXlFdmVudCksIHRydWU7CgkgIH07CgkgIGNvbnN0IG9rID0gKGV4dHJhKSA9PiB7CgkgICAgcmV0dXJuICgoZXZlbnQpID0+IHsKCSAgICAgIHJldHVybiBkaXNwYXRjaEV2ZW50KGV2ZW50LCAibW91c2Vkb3duIik7CgkgICAgfSkoZXh0cmEpICYmICgoZXZlbnQpID0+IHsKCSAgICAgIHJldHVybiBkaXNwYXRjaEV2ZW50KGV2ZW50LCAibW91c2V1cCIpOwoJICAgIH0pKGV4dHJhKTsKCSAgfTsKCSAgY29uc3QgdHJ5UGFyc2VRUkNvZGUgPSAoKSA9PiB7CgkgICAgbGV0IGludGVydmFsRnVuY3Rpb25DYWxsZWQgPSAkKCIuZGlhbG9nLWJvZHkgLnV0LWJ1dHRvbi1ncm91cCBidXR0b246ZXEoMCkiKTsKCSAgICBpZiAob2soaW50ZXJ2YWxGdW5jdGlvbkNhbGxlZCkpIHsKCSAgICAgIC8qKiBAdHlwZSB7Ym9vbGVhbn0gKi8KCSAgICAgIHMgPSBmYWxzZTsKCSAgICB9IGVsc2UgewoJICAgICAgc2V0VGltZW91dCh0cnlQYXJzZVFSQ29kZSwgMTApOwoJICAgIH0KCSAgfTsKCSAgY29uc3QgaW5uZXJUaW1lciA9ICgpID0+IHsKCSAgICBpZiAoIShuZXcgRGF0ZSAtIGxhc3RGZXRjaFRpbWUgPCA1MDApKSB7CgkgICAgICAvKiogQHR5cGUgeyFEYXRlfSAqLwoJICAgICAgbGFzdEZldGNoVGltZSA9IG5ldyBEYXRlOwoJICAgICAgaWYgKCFvaygkKCIudXQtbmF2aWdhdGlvbi1idXR0b24tY29udHJvbCIpKSkgewoJICAgICAgICBzZXRUaW1lb3V0KGlubmVyVGltZXIsIDEwKTsKCSAgICAgIH0KCSAgICB9CgkgIH07CgkgIGNvbnN0IGluaXQgPSAoKSA9PiB7CgkgIAljb25zb2xlLmxvZygnYWNhIHRhbWJpZW4nKQoJICAJYWxlcnQoKQoJICAgIGxldCBvYmogPSB7fTsKCSAgICBpZiAoJCgiLlNlYXJjaFJlc3VsdHMiKS5sZW5ndGggPiAwICYmIChvYmpbJHNjb3BlLmJhY2tdID0gKCkgPT4gewoJICAgICAgcmV0dXJuIGlubmVyVGltZXIoKTsKCSAgICB9KSwgJCgiLnV0LW1hcmtldC1zZWFyY2gtZmlsdGVycy12aWV3IikubGVuZ3RoID4gMCkgewoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmRlY01pbkJpZF0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuZGVjcmVtZW50LXZhbHVlIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5pbmNNaW5CaWRdID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmluY3JlbWVudC12YWx1ZSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guZGVjTWF4QmlkXSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5kZWNyZW1lbnQtdmFsdWU6ZXEoMSkiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmluY01heEJpZF0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuaW5jcmVtZW50LXZhbHVlOmVxKDEpIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5kZWNNaW5CdXldID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmRlY3JlbWVudC12YWx1ZTplcSgyKSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guaW5jTWluQnV5XSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5pbmNyZW1lbnQtdmFsdWU6ZXEoMikiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmRlY01heEJ1eV0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuZGVjcmVtZW50LXZhbHVlOmVxKDMpIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5pbmNNYXhCdXldID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmluY3JlbWVudC12YWx1ZTplcSgzKSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guc2VhcmNoXSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5idXR0b24tY29udGFpbmVyIC5idG4tc3RhbmRhcmQuY2FsbC10by1hY3Rpb24iKSk7CgkgICAgICB9OwoJICAgIH0gZWxzZSB7CgkgICAgICBsZXQgbiA9ICQoIi5saXN0RlVUSXRlbSIpOwoJICAgICAgbGV0IGkgPSBuLmxlbmd0aCA+IDA7CgkgICAgICBsZXQgcyA9IG4ucGFyZW50cygiLnBhZ2luYXRlZCwgLnV0LXdhdGNoLWxpc3QtdmlldywgLnV0LXRyYW5zZmVyLWxpc3QtdmlldyIpOwoJICAgICAgaWYgKDAgPT0gcy5sZW5ndGgpIHsKCSAgICAgICAgcyA9IG4ucGFyZW50KCk7CgkgICAgICB9CgkgICAgICBpZiAoaSAmJiAkKCIuRGV0YWlsUGFuZWwgPiAuYmlkT3B0aW9ucyIpLmxlbmd0aCA+IDApIHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUucmVzdWx0cy5iaWRdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygkKCIuYmlkQnV0dG9uIikpOwoJICAgICAgICB9OwoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5yZXN1bHRzLmJ1eV0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIHZvaWQob2soJCgiLmJ1eUJ1dHRvbiIpKSAmJiAkc2NvcGUucmVzdWx0cy5wcmVzc0VudGVyICYmIHRyeVBhcnNlUVJDb2RlKCkpOwoJICAgICAgICB9OwoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5yZXN1bHRzLmRlY0JpZF0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCQoIi5iaWRPcHRpb25zIC5kZWNyZW1lbnQtdmFsdWUiKSk7CgkgICAgICAgIH07CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLnJlc3VsdHMuaW5jQmlkXSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soJCgiLmJpZE9wdGlvbnMgLmluY3JlbWVudC12YWx1ZSIpKTsKCSAgICAgICAgfTsKCSAgICAgIH0KCSAgICAgIGlmIChpICYmICQoIi5EZXRhaWxQYW5lbCA+IC51dC1idXR0b24tZ3JvdXAiKS5sZW5ndGggPiAwKSB7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLnJlc3VsdHMudHJhbnNmZXJdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygoKCkgPT4gewoJICAgICAgICAgICAgcmV0dXJuICQoYC51dC1idXR0b24tZ3JvdXAgPiBidXR0b246Y29udGFpbnMoJyR7SGFuLmxvY2FsaXplKCJpbmZvcGFuZWwubGFiZWwuc2VuZFRyYWRlUGlsZSIpfScpYCk7CgkgICAgICAgICAgfSkoKSk7CgkgICAgICAgIH07CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLnJlc3VsdHMuY2x1Yl0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCgoKSA9PiB7CgkgICAgICAgICAgICByZXR1cm4gJChgLnV0LWJ1dHRvbi1ncm91cCA+IGJ1dHRvbjpjb250YWlucygnJHtIYW4ubG9jYWxpemUoImluZm9wYW5lbC5sYWJlbC5zdG9yZUluQ2x1YiIpfScpYCk7CgkgICAgICAgICAgfSkoKSk7CgkgICAgICAgIH07CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLnJlc3VsdHMuc2VsbF0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCgoKSA9PiB7CgkgICAgICAgICAgICByZXR1cm4gJChgLnV0LWJ1dHRvbi1ncm91cCA+IGJ1dHRvbjpjb250YWlucygnJHtIYW4ubG9jYWxpemUoImluZm9wYW5lbC5sYWJlbC5kaXNjYXJkIil9JylgKTsKCSAgICAgICAgICB9KSgpKTsKCSAgICAgICAgfTsKCSAgICAgIH0KCSAgICAgIGlmIChpKSB7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLmxpc3RzLnVwXSA9ICgpID0+IHsKCSAgICAgICAgICBsZXQgJHBhcmVudCA9IHM7CgkgICAgICAgICAgbGV0IHQgPSAkKCIubGlzdEZVVEl0ZW0uc2VsZWN0ZWQiLCAkcGFyZW50KS5wcmV2KCk7CgkgICAgICAgICAgb2sodCk7CgkgICAgICAgICAgJHBhcmVudC5jc3MoInBvc2l0aW9uIiwgInJlbGF0aXZlIik7CgkgICAgICAgICAgJHBhcmVudC5zY3JvbGxUb3AoJHBhcmVudC5zY3JvbGxUb3AoKSArIHQucG9zaXRpb24oKS50b3AgLSB0LmhlaWdodCgpKTsKCSAgICAgICAgfTsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUubGlzdHMuZG93bl0gPSAoKSA9PiB7CgkgICAgICAgICAgbGV0ICRwYXJlbnQgPSBzOwoJICAgICAgICAgIGxldCBpbnRlcnZhbEZ1bmN0aW9uQ2FsbGVkID0gJCgiLmxpc3RGVVRJdGVtLnNlbGVjdGVkIiwgJHBhcmVudCkubmV4dCgpOwoJICAgICAgICAgIG9rKGludGVydmFsRnVuY3Rpb25DYWxsZWQpOwoJICAgICAgICAgICRwYXJlbnQuY3NzKCJwb3NpdGlvbiIsICJyZWxhdGl2ZSIpOwoJICAgICAgICAgICRwYXJlbnQuc2Nyb2xsVG9wKCRwYXJlbnQuc2Nyb2xsVG9wKCkgKyBpbnRlcnZhbEZ1bmN0aW9uQ2FsbGVkLnBvc2l0aW9uKCkudG9wKTsKCSAgICAgICAgfTsKCSAgICAgIH0KCSAgICAgIGlmICgkKCIucGFnaW5nQ29udGFpbmVyIikubGVuZ3RoID4gMCkgewoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5saXN0cy5wcmV2XSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soJCgiLnBhZ2luZ0NvbnRhaW5lciAucHJldjp2aXNpYmxlIikpOwoJICAgICAgICB9OwoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5saXN0cy5uZXh0XSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soJCgiLnBhZ2luZ0NvbnRhaW5lciAubmV4dDp2aXNpYmxlIikpOwoJICAgICAgICB9OwoJICAgICAgfQoJICAgIH0KCSAgICByZXR1cm4gb2JqOwoJICB9OwoJICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLCAob2JqKSA9PiB7CgkgICAgaWYgKG9iai5rZXlDb2RlID09ICRzY29wZS5lbmFibGVEaXNhYmxlICYmIChldmVudCA9ICFldmVudCksICFldmVudCkgewoJICAgICAgcmV0dXJuOwoJICAgIH0KCSAgICBjb25zb2xlLmxvZyhvYmoua2V5Q29kZSkKCSAgICBsZXQgZ290b05ld09mZmxpbmVQYWdlID0gaW5pdCgpW29iai5rZXlDb2RlXTsKCSAgICBpZiAoZ290b05ld09mZmxpbmVQYWdlKSB7CgkgICAgICBnb3RvTmV3T2ZmbGluZVBhZ2UoKTsKCSAgICB9CgkgIH0pOwoJICBjb25zb2xlLmxvZyggZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlYXJjaFNuIikpCgkgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWFyY2hTbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24oKXsKCSAgCWFsZXJ0KCdlbnRyZScpCgkgIAljb25zb2xlLmxvZygiZW50cmUiKQoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZSA9IGluaXQoKVszOV07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZTIgPSBpbml0KClbNTBdOwoJICAgIGlmIChnb3RvTmV3T2ZmbGluZVBhZ2UyKSB7CgkgICAgICBnb3RvTmV3T2ZmbGluZVBhZ2UyKCk7CgkgICAgfQoJICB9KQoJICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmFja1NuIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpewoJICAJY29uc29sZS5sb2coImVudHJlIikKCSAgCQoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZSA9IGluaXQoKVs0OV07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJICB9KQoJICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5Tm93U24iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkgIAljb25zb2xlLmxvZygiZW50cmUiKQoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZSA9IGluaXQoKVs1MV07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJICB9KQoJfSh7CgkgICJiYWNrIiA6IDQ5LAoJICAiZW5hYmxlRGlzYWJsZSIgOiAxODgsCgkgICJ0ZWNoIiA6IDg0LAoJICAibGlzdHMiIDogewoJICAgICJ1cCIgOiAzOCwKCSAgICAiZG93biIgOiA0MCwKCSAgICAicHJldiIgOiAzNywKCSAgICAibmV4dCIgOiAzOQoJICB9LAoJICAic2VhcmNoIiA6IHsKCSAgICAiZGVjTWluQmlkIiA6IDM3LAoJICAgICJpbmNNaW5CaWQiIDogMzksCgkgICAgImRlY01heEJpZCIgOiAzNSwKCSAgICAiaW5jTWF4QmlkIiA6IDM2LAoJICAgICJkZWNNaW5CdXkiIDogNDYsCgkgICAgImluY01pbkJ1eSIgOiAzNCwKCSAgICAiZGVjTWF4QnV5IiA6IDQwLAoJICAgICJpbmNNYXhCdXkiIDogMzgsCgkgICAgInNlYXJjaCIgOiA1MAoJICB9LAoJICAicmVzdWx0cyIgOiB7CgkgICAgImJpZCIgOiA1MiwKCSAgICAiYnV5IiA6IDUxLAoJICAgICJ0cmFuc2ZlciIgOiA4MiwKCSAgICAiY2x1YiIgOiA2NywKCSAgICAicHJlc3NFbnRlciIgOiB0cnVlLAoJICAgICJhdXRvQnV5IiA6IGZhbHNlLAoJICAgICJwcmV2ZW50QmFjayIgOiB0cnVlLAoJICAgICJzZWxsIiA6IDgxLAoJICAgICJkZWNCaWQiIDogNDYsCgkgICAgImluY0JpZCIgOiAzNAoJICB9Cgl9KTsKCgoKCgp3aW5kb3cuaG9sYSA9IGZ1bmN0aW9uKCl7YWxlcnQoJ2hvbGEnKX0KCgoKVVRNYXJrZXRTZWFyY2hSZXN1bHRzVmlld0NvbnRyb2xsZXIucHJvdG90eXBlLl9yZXF1ZXN0SXRlbXMgPSBmdW5jdGlvbiBfcmVxdWVzdEl0ZW1zKGwpIHsKICAgIHRoaXMuX3BhZ2luYXRpb25WaWV3TW9kZWwuc3RvcEF1Y3Rpb25VcGRhdGVzKCk7CiAgICBpZih0aGlzLl9zZWFyY2hDcml0ZXJpYS5fdHlwZSA9PSAicGxheWVyIil7CiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOwoKICAgICAgICByZXF1ZXN0SXRlbXMoKQogICAgfSBlbHNlIHsKICAgICAgICBzZXJ2aWNlcy5JdGVtLnNlYXJjaFRyYW5zZmVyTWFya2V0KHRoaXMuX3NlYXJjaENyaXRlcmlhLCBsKS5vYnNlcnZlKHRoaXMsIGZ1bmN0aW9uIF9vblJlcXVlc3RJdGVtc0NvbXBsZXRlKGUsIHQpIHsKICAgICAgICAgICAgaWYgKGUudW5vYnNlcnZlKHRoaXMpLAogICAgICAgICAgICAhdC5zdWNjZXNzKQogICAgICAgICAgICAgICAgcmV0dXJuIE5ldHdvcmtFcnJvck1hbmFnZXIuY2hlY2tDcml0aWNhbFN0YXR1cyh0LnN0YXR1cykgPyB2b2lkIE5ldHdvcmtFcnJvck1hbmFnZXIuaGFuZGxlU3RhdHVzKHQuc3RhdHVzKSA6IChzZXJ2aWNlcy5Ob3RpZmljYXRpb24ucXVldWUoW3NlcnZpY2VzLkxvY2FsaXphdGlvbi5sb2NhbGl6ZSgicG9wdXAuZXJyb3Iuc2VhcmNoZXJyb3IiKSwgZW51bXMuVUlOb3RpZmljYXRpb25UeXBlLk5FR0FUSVZFXSksCiAgICAgICAgICAgICAgICB2b2lkIHRoaXMuZ2V0TmF2aWdhdGlvbkNvbnRyb2xsZXIoKS5wb3BWaWV3Q29udHJvbGxlcigpKTsKICAgICAgICAgICAgaWYgKDAgPCB0aGlzLl9zZWFyY2hDcml0ZXJpYS5vZmZzZXQgJiYgMCA9PT0gdC5kYXRhLml0ZW1zLmxlbmd0aCkKICAgICAgICAgICAgICAgIHRoaXMuX3JlcXVlc3RJdGVtcyhsIC0gMSk7CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9wYWdpbmF0aW9uVmlld01vZGVsLmdldE51bUl0ZW1zUGVyUGFnZSgpCiAgICAgICAgICAgICAgICB2YXIgbyA9IHQuZGF0YS5pdGVtcy5zbGljZSgpOwogICAgICAgICAgICAgICAgc2V0SXRlbXModGhpcyxvLGksdC5kYXRhLml0ZW1zKQogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuX3BhZ2luYXRpb25WaWV3TW9kZWwuc3RhcnRBdWN0aW9uVXBkYXRlcygpCiAgICAgICAgfSkKICAgIH0KCiAgICBmdW5jdGlvbiB1cGRhdGUoZGF0YSxjb250ZXh0KSB7CiAgICAgICAgVVRJdGVtRW50aXR5RmFjdG9yeS5wcm90b3R5cGUuYXVjdGlvbkZhY3RvcnkgPSBuZXcgVVRBdWN0aW9uRW50aXR5RmFjdG9yeSgpCiAgICAgICAgdmFyIGkgPSBjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLmdldE51bUl0ZW1zUGVyUGFnZSgpCiAgICAgICAgdmFyIG8gPSBVVEl0ZW1FbnRpdHlGYWN0b3J5LnByb3RvdHlwZS5nZW5lcmF0ZUl0ZW1zRnJvbUF1Y3Rpb25EYXRhKGRhdGEuYXVjdGlvbkluZm8pCiAgICAgICAgaWYgKDAgPCBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5vZmZzZXQgJiYgMCA9PT0gZGF0YS5hdWN0aW9uSW5mby5sZW5ndGgpCiAgICAgICAgICAgICAgICBjb250ZXh0Ll9yZXF1ZXN0SXRlbXMobCAtIDEpOwogICAgICAgIGVsc2UgewogICAgICAgICAgIHNldEl0ZW1zKGNvbnRleHQsbyxpLGRhdGEuYXVjdGlvbkluZm8pCiAgICAgICAgfQogICAgICAgIGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuc3RhcnRBdWN0aW9uVXBkYXRlcygpICAgCiAgICB9CgogICAgZnVuY3Rpb24gYWRkRmlsdGVycyhjb250ZXh0LHVybCl7CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEucmFyaXRpZXMubGVuZ3RoPjApewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJnJhcml0eUlkcz0iK2NvbnRleHQuX3NlYXJjaENyaXRlcmlhLnJhcml0aWVzWzBdICAgIAogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5uYXRpb24hPS0xKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZuYXQ9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubmF0aW9uCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmxldmVsIT0iYW55Iil7CiAgICAgICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmxldmVsID09ICJTUCIpewogICAgICAgICAgICAgICAgdXJsID0gdXJsICsgIiZyYXJlPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmxldmVsCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB1cmwgPSB1cmwgKyAiJmxldj0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5sZXZlbAogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmNsdWIhPS0xKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZ0ZWFtPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmNsdWIKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEuX3pvbmUhPS0xKXsKICAgICAgICAgICAgdmFyIHpvbmVzID0gewogICAgICAgICAgICAgICAgIjEzMCI6ICJkZWZlbnNlIiwKICAgICAgICAgICAgICAgICIxMzEiOiAibWlkZmllbGQiLAogICAgICAgICAgICAgICAgIjEzMiI6ICJhdHRhY2tlciIgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXJsID0gdXJsICsgIiZ6b25lPSIrIHpvbmVzW2NvbnRleHQuX3NlYXJjaENyaXRlcmlhLl96b25lXQogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5wb3NpdGlvbiE9ImFueSIpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJnBvcz0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5wb3NpdGlvbgogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5tYXNrZWREZWZJZCl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbWFza2VkRGVmSWQ9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWFza2VkRGVmSWQKICAgICAgICB9ICAgIAogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmxlYWd1ZSE9LTEpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJmxlYWc9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubGVhZ3VlCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnBsYXlTdHlsZSE9LTEpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJnBsYXlTdHlsZT0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5wbGF5U3R5bGUKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWluQnV5KXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZtaW5iPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1pbkJ1eQogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5tYXhCdXkpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJm1heGI9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWF4QnV5CiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1pbkJpZCl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbWljcj0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5taW5CaWQKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWluQmlkKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZtaWNyPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1pbkJpZAogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5tYXhCaWQpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJm1hY3I9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWF4QmlkCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmRlZklkLmxlbmd0aD4wKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZkZWZpbml0aW9uSWQ9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEuZGVmSWRbMF0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHVybAogICAgfQoKICAgIGZ1bmN0aW9uIHJlcXVlc3RJdGVtcygpewogICAgICAgIHZhciB1cmwgPSBgJHtzZXJ2aWNlcy5BdXRoZW50aWNhdGlvbi5zZXNzaW9uVXRhcy51cmx9L3V0L2dhbWUvZmlmYTIxL3RyYW5zZmVybWFya2V0P251bT0yMSZzdGFydD0keyhsLTEpKjIwfSZ0eXBlPXBsYXllcmA7CiAgICAgICAgdXJsID0gYWRkRmlsdGVycyhjb250ZXh0LHVybCkKICAgICAgICBmZXRjaCh1cmwsIHsKICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAiWC1VVC1TSUQiOiBzZXJ2aWNlcy5BdXRoZW50aWNhdGlvbi5nZXRVdGFzU2Vzc2lvbigpWyJpZCJdCiAgICAgICAgfX0pLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2UpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGRhdGEpIHsKICAgICAgICAgICAgdXBkYXRlKGRhdGEsY29udGV4dCkgICAgICAgICAgICAgCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3IpewogICAgICAgICAgICBzZXJ2aWNlcy5Ob3RpZmljYXRpb24ucXVldWUoW3NlcnZpY2VzLkxvY2FsaXphdGlvbi5sb2NhbGl6ZSgicG9wdXAuZXJyb3Iuc2VhcmNoZXJyb3IiKSxlbnVtcy5VSU5vdGlmaWNhdGlvblR5cGUuTkVHQVRJVkVdKQogICAgICAgICAgICB2b2lkIGNvbnRleHQuZ2V0TmF2aWdhdGlvbkNvbnRyb2xsZXIoKS5wb3BWaWV3Q29udHJvbGxlcigpOwogICAgICAgIH0pCiAgICB9CgogICAgZnVuY3Rpb24gc2V0SXRlbXMoY29udGV4dCxvLGkscmVzcG9uc2VJdGVtcyl7CiAgICAgICAgaWYgKGNvbnRleHQub25EYXRhQ2hhbmdlLm5vdGlmeSh7CiAgICAgICAgICAgIGl0ZW1zOiBvCiAgICAgICAgfSksCiAgICAgICAgby5sZW5ndGggPiBpICYmIChvID0gby5zbGljZSgwLCBpKSksCiAgICAgICAgY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5zZXRQYWdlSXRlbXMobyksCiAgICAgICAgY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5zZXRQYWdlSW5kZXgobCksCiAgICAgICAgY29udGV4dC5fc2VsZWN0ZWRJdGVtICYmIDAgPCBvLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgbiA9IGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuZ2V0SW5kZXhCeUl0ZW1JZChjb250ZXh0Ll9zZWxlY3RlZEl0ZW0uaWQpOwogICAgICAgICAgICAwIDwgbiAmJiBjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLnNldEluZGV4KG4pLAogICAgICAgICAgICBjb250ZXh0Ll9zZWxlY3RlZEl0ZW0gPSBudWxsCiAgICAgICAgfQogICAgICAgIHZhciBzID0gY29udGV4dC5nZXRWaWV3KCkKICAgICAgICAgICwgciA9IG51bGw7CiAgICAgICAgaWYgKCFjb250ZXh0Ll9zdGFkaXVtVmlld21vZGVsIHx8IGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnR5cGUgIT09IFNlYXJjaFR5cGUuVkFOSVRZICYmIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnR5cGUgIT09IFNlYXJjaFR5cGUuQ0xVQl9JTkZPICYmIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnR5cGUgIT09IFNlYXJjaFR5cGUuQkFMTCB8fCAociA9IGNvbnRleHQuX3N0YWRpdW1WaWV3bW9kZWwuZ2V0U3RhZGl1bVByb2dyZXNzaW9uKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnN1YnR5cGVzKSksCiAgICAgICAgcy5zZXRJdGVtcyhjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLmdldEN1cnJlbnRQYWdlSXRlbXMoKSwgciksCiAgICAgICAgcy5zZXRQYWdpbmF0aW9uU3RhdGUoMSA8IGwsIHJlc3BvbnNlSXRlbXMubGVuZ3RoID4gaSksCiAgICAgICAgSlNVdGlscy5pc1ZhbGlkKGNvbnRleHQuX2NvbXBhcmVJdGVtKSAmJiAhY29udGV4dC5fc3F1YWRDb250ZXh0KSB7CiAgICAgICAgICAgIHZhciBhID0gSlNVdGlscy5maW5kKG8sIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBlLmdldEF1Y3Rpb25EYXRhKCkudHJhZGVJZCA9PT0gY29udGV4dC5fY29tcGFyZUl0ZW0uZ2V0QXVjdGlvbkRhdGEoKS50cmFkZUlkCiAgICAgICAgICAgIH0KICAgICAgICAgICAgLmJpbmQoY29udGV4dCkpOwogICAgICAgICAgICBKU1V0aWxzLmlzVmFsaWQoYSkgPyBjb250ZXh0Ll9waW5uZWRMaXN0SXRlbS5zZXRJdGVtKGEpIDogY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5zZXRQaW5uZWRJdGVtKGNvbnRleHQuX2NvbXBhcmVJdGVtKQogICAgICAgIH0gZWxzZQogICAgICAgICAgICAhaXNQaG9uZSgpICYmIDAgPCBvLmxlbmd0aCAmJiBzLnNlbGVjdExpc3RSb3coY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5nZXRDdXJyZW50SXRlbSgpLmlkKQogICAgfQp9CgoKYWNjZXNzb2JqZWN0cy5DbHViLmdldFVybFBhcmFtcyA9IGZ1bmN0aW9uKHNlYXJjaENyaXRlcmlhKSB7CiAgICB2YXIgY3JpdGVyaWEgPSB7fTsKICAgIGNyaXRlcmlhLnR5cGUgPSBzZWFyY2hDcml0ZXJpYS50eXBlID09PSBTZWFyY2hUeXBlLkFOWSA/IFNlYXJjaFR5cGUuUExBWUVSIDogc2VhcmNoQ3JpdGVyaWEudHlwZSwKICAgIGNyaXRlcmlhLnN0YXJ0ID0gc2VhcmNoQ3JpdGVyaWEub2Zmc2V0LAogICAgY3JpdGVyaWEuY291bnQgPSBzZWFyY2hDcml0ZXJpYS5jb3VudDsKICAgIHZhciBmb3JtZWRDcml0ZXJpYSA9IGNyaXRlcmlhOwogICAgc2VhcmNoQ3JpdGVyaWEuc29ydEJ5ID09PSBTZWFyY2hTb3J0VHlwZS5SRUNFTkNZID8gZm9ybWVkQ3JpdGVyaWEuYWNxdWlyZWREYXRlID0gc2VhcmNoQ3JpdGVyaWEuc29ydCA6IChmb3JtZWRDcml0ZXJpYS5zb3J0ID0gc2VhcmNoQ3JpdGVyaWEuc29ydCwKICAgIGZvcm1lZENyaXRlcmlhLnNvcnQgIT09IFNlYXJjaFNvcnRPcmRlci5OT05FICYmIChmb3JtZWRDcml0ZXJpYS5zb3J0QnkgPSBzZWFyY2hDcml0ZXJpYS5zb3J0QnkpKTsKICAgIGlmIChzZWFyY2hDcml0ZXJpYS50eXBlID09PSBTZWFyY2hUeXBlLlZBTklUWSkKICAgICAgICBmb3JtZWRDcml0ZXJpYS52YW5pdHlTdWJUeXBlSWRzID0gc2VhcmNoQ3JpdGVyaWEuc3VidHlwZXM7CiAgICBlbHNlCiAgICAgICAgc2VhcmNoQ3JpdGVyaWEuY2F0ZWdvcnkgIT09IFNlYXJjaENhdGVnb3J5LkFOWSAmJiAoZm9ybWVkQ3JpdGVyaWEudHlwZSA9IHNlYXJjaENyaXRlcmlhLmNhdGVnb3J5LnRvTG93ZXJDYXNlKCkpOwogICAgaWYgKHNlYXJjaENyaXRlcmlhLnJhcml0aWVzLmxlbmd0aCA+IDApCiAgICAgICAgZm9ybWVkQ3JpdGVyaWEucmFyaXR5SWRzID0gc2VhcmNoQ3JpdGVyaWEucmFyaXRpZXMuam9pbignLCcpOwogICAgaWYgKHNlYXJjaENyaXRlcmlhLmxldmVsID09PSBlbnVtcy5TZWFyY2hMZXZlbC5TUEVDSUFMKQogICAgICAgIGZvcm1lZENyaXRlcmlhLnJhcmUgPSBzZWFyY2hDcml0ZXJpYS5sZXZlbDsKICAgIGVsc2UKICAgICAgICBzZWFyY2hDcml0ZXJpYS5sZXZlbCAhPT0gZW51bXMuU2VhcmNoTGV2ZWwuQU5ZICYmIChmb3JtZWRDcml0ZXJpYS5sZXZlbCA9IHNlYXJjaENyaXRlcmlhLmxldmVsKTsKICAgIHNlYXJjaENyaXRlcmlhLmNsdWIgPiAwICYmIChmb3JtZWRDcml0ZXJpYS50ZWFtID0gc2VhcmNoQ3JpdGVyaWEuY2x1Yik7CiAgICBzZWFyY2hDcml0ZXJpYS5sZWFndWUgPiAwICYmIChmb3JtZWRDcml0ZXJpYS5sZWFndWUgPSBzZWFyY2hDcml0ZXJpYS5sZWFndWUpOwogICAgc2VhcmNoQ3JpdGVyaWEubmF0aW9uID4gMCAmJiAoZm9ybWVkQ3JpdGVyaWEubmF0aW9uID0gc2VhcmNoQ3JpdGVyaWEubmF0aW9uKTsKICAgIHNlYXJjaENyaXRlcmlhLnVudHJhZGVhYmxlcyAhPT0gZW51bXMuU2VhcmNoVW50cmFkZWFibGVzLkRFRkFVTFQgJiYgKGZvcm1lZENyaXRlcmlhLmlzVW50cmFkZWFibGUgPSBzZWFyY2hDcml0ZXJpYS51bnRyYWRlYWJsZXMpOwogICAgc2VhcmNoQ3JpdGVyaWEuZXhjbHVkZURlZklkcy5sZW5ndGggPiAwICYmIChmb3JtZWRDcml0ZXJpYS5leGNsZGVmID0gc2VhcmNoQ3JpdGVyaWEuZXhjbHVkZURlZklkcy5qb2luKCcsJykpOwogICAgc2VhcmNoQ3JpdGVyaWEuaXNFeGFjdFNlYXJjaCAmJiAoZm9ybWVkQ3JpdGVyaWEuZmlsdGVyID0gImV4YWN0Iik7CiAgICBpZiAoc2VhcmNoQ3JpdGVyaWEuem9uZSAhPT0gLTEpCiAgICAgICAgc3dpdGNoIChzZWFyY2hDcml0ZXJpYS56b25lKSB7CiAgICAgICAgY2FzZSBaT05FX0RFRkVOREVSX1ZBTFVFOgogICAgICAgICAgICBmb3JtZWRDcml0ZXJpYVsidHlwZSJdID0gInBsYXllcmRlZmVuZGVyIjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBaT05FX01JREZJRUxERVJfVkFMVUU6CiAgICAgICAgICAgIGZvcm1lZENyaXRlcmlhWyJ0eXBlIl0gPSAicGxheWVybWlkZmllbGRlciI7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgWk9ORV9BVFRBQ0tFUl9WQUxVRToKICAgICAgICAgICAgZm9ybWVkQ3JpdGVyaWFbInR5cGUiXSA9ICJwbGF5ZXJmb3J3YXJkIjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBaT05FX05PX0dLX1ZBTFVFOgogICAgICAgICAgICBmb3JtZWRDcml0ZXJpYVsidHlwZSJdID0gInBsYXllcm5vbkdLIjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgRGVidWdVdGlscy5Bc3NlcnQoIVtdLCAiVW5zdXBwb3J0ZWQgem9uZSBJRCBpbiBjbHViIHNlYXJjaC4iKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgZWxzZQogICAgICAgIHNlYXJjaENyaXRlcmlhLnBvc2l0aW9uICE9PSBTZWFyY2hUeXBlWyJBTlkiXSAmJiAoZm9ybWVkQ3JpdGVyaWEucG9zaXRpb24gPSBzZWFyY2hDcml0ZXJpYS5wb3NpdGlvbik7CiAgICByZXR1cm4gc2VhcmNoQ3JpdGVyaWEucGxheVN0eWxlID4gMCAmJiAoZm9ybWVkQ3JpdGVyaWEucGxheVN0eWxlID0gc2VhcmNoQ3JpdGVyaWEucGxheVN0eWxlKSwKICAgIHNlYXJjaENyaXRlcmlhLmhhc1ZhbGlkRGVmSWQoKSAmJiAoZm9ybWVkQ3JpdGVyaWEuZGVmSWQgPSBzZWFyY2hDcml0ZXJpYS5kZWZJZC5qb2luKCcsJykpLAogICAgZm9ybWVkQ3JpdGVyaWE7Cn0='))
