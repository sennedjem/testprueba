javascript:eval(atob('CS8qKgoJIgoJPG5hdiBjbGFzcz0ndXQtdGFiLWJhcic+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2JhY2tTbic+PHNwYW4+QXRyYXM8L3NwYW4+PC9idXR0b24+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+CgkJPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2J1eU5vd1NuJz48c3Bhbj5Db21wcmEgeWE8L3NwYW4+PC9idXR0b24+Cgk8L25hdj4iCgoKCXZhciBzdHJpbmcgPSAiPG5hdiBjbGFzcz0ndXQtdGFiLWJhcic+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2JhY2tTbic+PHNwYW4+QXRyYXM8L3NwYW4+PC9idXR0b24+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+PGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J2J1eU5vd1NuJz48c3Bhbj5Db21wcmEgeWE8L3NwYW4+PC9idXR0b24+PC9uYXY+IgoKCWZ1bmN0aW9uIG15RnVuY3Rpb24oKXsKCQlsZXQgZ290b05ld09mZmxpbmVQYWdlID0gaW5pdCgpWyIyIl07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJfQoKCgkkKGZ1bmN0aW9uKCl7CgkgIHZhciAkYnV0dG9uID0gJCgnLnV0LXRhYi1iYXInKS5jbG9uZSgpOwoJICAkYnV0dG9uLmVtcHR5KCkKCSAgJGJ1dHRvbi5hcHBlbmQoIjxidXR0b24gY2xhc3M9J3V0LXRhYi1iYXItaXRlbSAnIGlkPSdiYWNrU24nPjxzcGFuPkF0cmFzPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtICcgaWQ9J3NlYXJjaFNuJz48c3Bhbj5CdXNjYXI8L3NwYW4+PC9idXR0b24+Iik7CgkgICRidXR0b24uYXBwZW5kKCI8YnV0dG9uIGNsYXNzPSd1dC10YWItYmFyLWl0ZW0gJyBpZD0nYnV5Tm93U24nPjxzcGFuPkNvbXByYSB5YTwvc3Bhbj48L2J1dHRvbj4iKTsKCSAgJCgnLnV0LXRhYi1iYXInKS5iZWZvcmUoJGJ1dHRvbik7Cgl9KTsKCSovCgoKCgoJIWZ1bmN0aW9uIGphamEoZSkgewoJICBsZXQgJHNjb3BlID0gZSA9ICQuZXh0ZW5kKHsKCSAgICBiYWNrIDogNDksCgkgICAgZW5hYmxlRGlzYWJsZSA6IDkyLAoJICAgIGxpc3RzIDogewoJICAgICAgdXAgOiAzOCwKCSAgICAgIGRvd24gOiA0MCwKCSAgICAgIHByZXYgOiAzNywKCSAgICAgIG5leHQgOiAzOQoJICAgIH0sCgkgICAgc2VhcmNoIDogewoJICAgICAgZGVjTWluQmlkIDogMzcsCgkgICAgICBpbmNNaW5CaWQgOiAzOSwKCSAgICAgIGRlY01heEJpZCA6IDM1LAoJICAgICAgaW5jTWF4QmlkIDogMzYsCgkgICAgICBkZWNNaW5CdXkgOiA0NiwKCSAgICAgIGluY01pbkJ1eSA6IDM0LAoJICAgICAgZGVjTWF4QnV5IDogNDAsCgkgICAgICBpbmNNYXhCdXkgOiAzOCwKCSAgICAgIHNlYXJjaCA6IDUwCgkgICAgfSwKCSAgICByZXN1bHRzIDogewoJICAgICAgYmlkIDogNTIsCgkgICAgICBidXkgOiA1MSwKCSAgICAgIHRyYW5zZmVyIDogODIsCgkgICAgICBjbHViIDogNjcsCgkgICAgICBwcmVzc0VudGVyIDogdHJ1ZSwKCSAgICAgIGF1dG9CdXkgOiBmYWxzZSwKCSAgICAgIHByZXZlbnRCYWNrIDogZmFsc2UsCgkgICAgICBzZWxsIDogODEsCgkgICAgICBkZWNCaWQgOiA0NiwKCSAgICAgIGluY0JpZCA6IDM0CgkgICAgfQoJICB9LCBlIHx8IHt9KTsKCSAgdmFyICRidXR0b24gPSAkKCcudXQtdGFiLWJhcicpLmNsb25lKCk7CgkgICRidXR0b24uZW1wdHkoKQoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtJyBpZD0nYmFja1NuJyBzdHlsZT0nIGN1cnNvcjogcG9pbnRlcjsnPjxzcGFuPkF0cmFzPC9zcGFuPjwvYnV0dG9uPiIpOwoJICAkYnV0dG9uLmFwcGVuZCgiPGJ1dHRvbiBjbGFzcz0ndXQtdGFiLWJhci1pdGVtJyBpZD0nc2VhcmNoU24nIHN0eWxlPSdiYWNrZ3JvdW5kOiBvcmFuZ2U7IGN1cnNvcjogcG9pbnRlcjsnPjxzcGFuPkJ1c2Nhcjwvc3Bhbj48L2J1dHRvbj4iKTsKCSAgJGJ1dHRvbi5hcHBlbmQoIjxidXR0b24gY2xhc3M9J3V0LXRhYi1iYXItaXRlbScgaWQ9J2J1eU5vd1NuJyBzdHlsZT0nIGN1cnNvcjogcG9pbnRlcjsnPjxzcGFuPkNvbXByYSB5YTwvc3Bhbj48L2J1dHRvbj4iKTsKCSAgJCgnLnV0LW5hdmlnYXRpb24tY29udGFpbmVyLXZpZXcnKS5hZnRlcigkYnV0dG9uKTsKCSAgYWxlcnQoJ2luaWNpYW5kbycpCgkgIGxldCBldmVudCA9IHRydWU7CgkgIGxldCBsYXN0RmV0Y2hUaW1lID0gbmV3IERhdGU7CgkgIGxldCBzID0gZmFsc2U7CgkgIC8qKiBAdHlwZSB7bnVtYmVyfSAqLwoJICB3aW5kb3cuTUFYX05FV19JVEVNUyA9IE51bWJlci5NQVhfVkFMVUU7CgkgIGNvbnN0IEhhbiA9IHdpbmRvdy5zZXJ2aWNlcy5Mb2NhbGl6YXRpb247CgkgIGNvbnN0IGRpc3BhdGNoRXZlbnQgPSAoZWxlbSwgdHlwZSkgPT4gewoJICAgIGlmICgwID09IGVsZW0ubGVuZ3RoKSB7CgkgICAgICByZXR1cm4gZmFsc2U7CgkgICAgfQoJICAgIGNvbnN0IHJlcGxheUV2ZW50ID0gZG9jdW1lbnQuY3JlYXRlRXZlbnQoIk1vdXNlRXZlbnRzIik7CgkgICAgcmV0dXJuIHJlcGxheUV2ZW50LmluaXRFdmVudCh0eXBlKSwgZWxlbVswXS5kaXNwYXRjaEV2ZW50KHJlcGxheUV2ZW50KSwgdHJ1ZTsKCSAgfTsKCSAgY29uc3Qgb2sgPSAoZXh0cmEpID0+IHsKCSAgICByZXR1cm4gKChldmVudCkgPT4gewoJICAgICAgcmV0dXJuIGRpc3BhdGNoRXZlbnQoZXZlbnQsICJtb3VzZWRvd24iKTsKCSAgICB9KShleHRyYSkgJiYgKChldmVudCkgPT4gewoJICAgICAgcmV0dXJuIGRpc3BhdGNoRXZlbnQoZXZlbnQsICJtb3VzZXVwIik7CgkgICAgfSkoZXh0cmEpOwoJICB9OwoJICBjb25zdCB0cnlQYXJzZVFSQ29kZSA9ICgpID0+IHsKCSAgICBsZXQgaW50ZXJ2YWxGdW5jdGlvbkNhbGxlZCA9ICQoIi5kaWFsb2ctYm9keSAudXQtYnV0dG9uLWdyb3VwIGJ1dHRvbjplcSgwKSIpOwoJICAgIGlmIChvayhpbnRlcnZhbEZ1bmN0aW9uQ2FsbGVkKSkgewoJICAgICAgLyoqIEB0eXBlIHtib29sZWFufSAqLwoJICAgICAgcyA9IGZhbHNlOwoJICAgIH0gZWxzZSB7CgkgICAgICBzZXRUaW1lb3V0KHRyeVBhcnNlUVJDb2RlLCAxMCk7CgkgICAgfQoJICB9OwoJICBjb25zdCBpbm5lclRpbWVyID0gKCkgPT4gewoJICAgIGlmICghKG5ldyBEYXRlIC0gbGFzdEZldGNoVGltZSA8IDUwMCkpIHsKCSAgICAgIC8qKiBAdHlwZSB7IURhdGV9ICovCgkgICAgICBsYXN0RmV0Y2hUaW1lID0gbmV3IERhdGU7CgkgICAgICBpZiAoIW9rKCQoIi51dC1uYXZpZ2F0aW9uLWJ1dHRvbi1jb250cm9sIikpKSB7CgkgICAgICAgIHNldFRpbWVvdXQoaW5uZXJUaW1lciwgMTApOwoJICAgICAgfQoJICAgIH0KCSAgfTsKCSAgY29uc3QgaW5pdCA9ICgpID0+IHsKCSAgCWNvbnNvbGUubG9nKCdhY2EgdGFtYmllbicpCgkgICAgbGV0IG9iaiA9IHt9OwoJICAgIGlmICgkKCIuU2VhcmNoUmVzdWx0cyIpLmxlbmd0aCA+IDAgJiYgKG9ialskc2NvcGUuYmFja10gPSAoKSA9PiB7CgkgICAgICByZXR1cm4gaW5uZXJUaW1lcigpOwoJICAgIH0pLCAkKCIudXQtbWFya2V0LXNlYXJjaC1maWx0ZXJzLXZpZXciKS5sZW5ndGggPiAwKSB7CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guZGVjTWluQmlkXSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5kZWNyZW1lbnQtdmFsdWUiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmluY01pbkJpZF0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuaW5jcmVtZW50LXZhbHVlIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5kZWNNYXhCaWRdID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmRlY3JlbWVudC12YWx1ZTplcSgxKSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guaW5jTWF4QmlkXSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5pbmNyZW1lbnQtdmFsdWU6ZXEoMSkiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmRlY01pbkJ1eV0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuZGVjcmVtZW50LXZhbHVlOmVxKDIpIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5pbmNNaW5CdXldID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmluY3JlbWVudC12YWx1ZTplcSgyKSIpKTsKCSAgICAgIH07CgkgICAgICAvKioKCSAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAqLwoJICAgICAgb2JqWyRzY29wZS5zZWFyY2guZGVjTWF4QnV5XSA9ICgpID0+IHsKCSAgICAgICAgcmV0dXJuIG9rKCQoIi5kZWNyZW1lbnQtdmFsdWU6ZXEoMykiKSk7CgkgICAgICB9OwoJICAgICAgLyoqCgkgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgKi8KCSAgICAgIG9ialskc2NvcGUuc2VhcmNoLmluY01heEJ1eV0gPSAoKSA9PiB7CgkgICAgICAgIHJldHVybiBvaygkKCIuaW5jcmVtZW50LXZhbHVlOmVxKDMpIikpOwoJICAgICAgfTsKCSAgICAgIC8qKgoJICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICovCgkgICAgICBvYmpbJHNjb3BlLnNlYXJjaC5zZWFyY2hdID0gKCkgPT4gewoJICAgICAgICByZXR1cm4gb2soJCgiLmJ1dHRvbi1jb250YWluZXIgLmJ0bi1zdGFuZGFyZC5jYWxsLXRvLWFjdGlvbiIpKTsKCSAgICAgIH07CgkgICAgfSBlbHNlIHsKCSAgICAgIGxldCBuID0gJCgiLmxpc3RGVVRJdGVtIik7CgkgICAgICBsZXQgaSA9IG4ubGVuZ3RoID4gMDsKCSAgICAgIGxldCBzID0gbi5wYXJlbnRzKCIucGFnaW5hdGVkLCAudXQtd2F0Y2gtbGlzdC12aWV3LCAudXQtdHJhbnNmZXItbGlzdC12aWV3Iik7CgkgICAgICBpZiAoMCA9PSBzLmxlbmd0aCkgewoJICAgICAgICBzID0gbi5wYXJlbnQoKTsKCSAgICAgIH0KCSAgICAgIGlmIChpICYmICQoIi5EZXRhaWxQYW5lbCA+IC5iaWRPcHRpb25zIikubGVuZ3RoID4gMCkgewoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5yZXN1bHRzLmJpZF0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCQoIi5iaWRCdXR0b24iKSk7CgkgICAgICAgIH07CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLnJlc3VsdHMuYnV5XSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gdm9pZChvaygkKCIuYnV5QnV0dG9uIikpICYmICRzY29wZS5yZXN1bHRzLnByZXNzRW50ZXIgJiYgdHJ5UGFyc2VRUkNvZGUoKSk7CgkgICAgICAgIH07CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLnJlc3VsdHMuZGVjQmlkXSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soJCgiLmJpZE9wdGlvbnMgLmRlY3JlbWVudC12YWx1ZSIpKTsKCSAgICAgICAgfTsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUucmVzdWx0cy5pbmNCaWRdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygkKCIuYmlkT3B0aW9ucyAuaW5jcmVtZW50LXZhbHVlIikpOwoJICAgICAgICB9OwoJICAgICAgfQoJICAgICAgaWYgKGkgJiYgJCgiLkRldGFpbFBhbmVsID4gLnV0LWJ1dHRvbi1ncm91cCIpLmxlbmd0aCA+IDApIHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUucmVzdWx0cy50cmFuc2Zlcl0gPSAoKSA9PiB7CgkgICAgICAgICAgcmV0dXJuIG9rKCgoKSA9PiB7CgkgICAgICAgICAgICByZXR1cm4gJChgLnV0LWJ1dHRvbi1ncm91cCA+IGJ1dHRvbjpjb250YWlucygnJHtIYW4ubG9jYWxpemUoImluZm9wYW5lbC5sYWJlbC5zZW5kVHJhZGVQaWxlIil9JylgKTsKCSAgICAgICAgICB9KSgpKTsKCSAgICAgICAgfTsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUucmVzdWx0cy5jbHViXSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soKCgpID0+IHsKCSAgICAgICAgICAgIHJldHVybiAkKGAudXQtYnV0dG9uLWdyb3VwID4gYnV0dG9uOmNvbnRhaW5zKCcke0hhbi5sb2NhbGl6ZSgiaW5mb3BhbmVsLmxhYmVsLnN0b3JlSW5DbHViIil9JylgKTsKCSAgICAgICAgICB9KSgpKTsKCSAgICAgICAgfTsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUucmVzdWx0cy5zZWxsXSA9ICgpID0+IHsKCSAgICAgICAgICByZXR1cm4gb2soKCgpID0+IHsKCSAgICAgICAgICAgIHJldHVybiAkKGAudXQtYnV0dG9uLWdyb3VwID4gYnV0dG9uOmNvbnRhaW5zKCcke0hhbi5sb2NhbGl6ZSgiaW5mb3BhbmVsLmxhYmVsLmRpc2NhcmQiKX0nKWApOwoJICAgICAgICAgIH0pKCkpOwoJICAgICAgICB9OwoJICAgICAgfQoJICAgICAgaWYgKGkpIHsKCSAgICAgICAgLyoqCgkgICAgICAgICAqIEByZXR1cm4ge3VuZGVmaW5lZH0KCSAgICAgICAgICovCgkgICAgICAgIG9ialskc2NvcGUubGlzdHMudXBdID0gKCkgPT4gewoJICAgICAgICAgIGxldCAkcGFyZW50ID0gczsKCSAgICAgICAgICBsZXQgdCA9ICQoIi5saXN0RlVUSXRlbS5zZWxlY3RlZCIsICRwYXJlbnQpLnByZXYoKTsKCSAgICAgICAgICBvayh0KTsKCSAgICAgICAgICAkcGFyZW50LmNzcygicG9zaXRpb24iLCAicmVsYXRpdmUiKTsKCSAgICAgICAgICAkcGFyZW50LnNjcm9sbFRvcCgkcGFyZW50LnNjcm9sbFRvcCgpICsgdC5wb3NpdGlvbigpLnRvcCAtIHQuaGVpZ2h0KCkpOwoJICAgICAgICB9OwoJICAgICAgICAvKioKCSAgICAgICAgICogQHJldHVybiB7dW5kZWZpbmVkfQoJICAgICAgICAgKi8KCSAgICAgICAgb2JqWyRzY29wZS5saXN0cy5kb3duXSA9ICgpID0+IHsKCSAgICAgICAgICBsZXQgJHBhcmVudCA9IHM7CgkgICAgICAgICAgbGV0IGludGVydmFsRnVuY3Rpb25DYWxsZWQgPSAkKCIubGlzdEZVVEl0ZW0uc2VsZWN0ZWQiLCAkcGFyZW50KS5uZXh0KCk7CgkgICAgICAgICAgb2soaW50ZXJ2YWxGdW5jdGlvbkNhbGxlZCk7CgkgICAgICAgICAgJHBhcmVudC5jc3MoInBvc2l0aW9uIiwgInJlbGF0aXZlIik7CgkgICAgICAgICAgJHBhcmVudC5zY3JvbGxUb3AoJHBhcmVudC5zY3JvbGxUb3AoKSArIGludGVydmFsRnVuY3Rpb25DYWxsZWQucG9zaXRpb24oKS50b3ApOwoJICAgICAgICB9OwoJICAgICAgfQoJICAgICAgaWYgKCQoIi5wYWdpbmdDb250YWluZXIiKS5sZW5ndGggPiAwKSB7CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLmxpc3RzLnByZXZdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygkKCIucGFnaW5nQ29udGFpbmVyIC5wcmV2OnZpc2libGUiKSk7CgkgICAgICAgIH07CgkgICAgICAgIC8qKgoJICAgICAgICAgKiBAcmV0dXJuIHt1bmRlZmluZWR9CgkgICAgICAgICAqLwoJICAgICAgICBvYmpbJHNjb3BlLmxpc3RzLm5leHRdID0gKCkgPT4gewoJICAgICAgICAgIHJldHVybiBvaygkKCIucGFnaW5nQ29udGFpbmVyIC5uZXh0OnZpc2libGUiKSk7CgkgICAgICAgIH07CgkgICAgICB9CgkgICAgfQoJICAgIHJldHVybiBvYmo7CgkgIH07CgkgIGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIChvYmopID0+IHsKCSAgICBpZiAob2JqLmtleUNvZGUgPT0gJHNjb3BlLmVuYWJsZURpc2FibGUgJiYgKGV2ZW50ID0gIWV2ZW50KSwgIWV2ZW50KSB7CgkgICAgICByZXR1cm47CgkgICAgfQoJICAgIGNvbnNvbGUubG9nKG9iai5rZXlDb2RlKQoJICAgIGxldCBnb3RvTmV3T2ZmbGluZVBhZ2UgPSBpbml0KClbb2JqLmtleUNvZGVdOwoJICAgIGlmIChnb3RvTmV3T2ZmbGluZVBhZ2UpIHsKCSAgICAgIGdvdG9OZXdPZmZsaW5lUGFnZSgpOwoJICAgIH0KCSAgfSk7CgkgIGNvbnNvbGUubG9nKCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic2VhcmNoU24iKSkKCSAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInNlYXJjaFNuIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpewoJICAJY29uc29sZS5sb2coImVudHJlIikKCSAgCWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWFyY2hTbiIpLnN0eWxlLmJhY2tncm91bmRDb2xvcj0ncmVkJwoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZSA9IGluaXQoKVszOV07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZTIgPSBpbml0KClbNTBdOwoJICAgIGlmIChnb3RvTmV3T2ZmbGluZVBhZ2UyKSB7CgkgICAgICBnb3RvTmV3T2ZmbGluZVBhZ2UyKCk7CgkgICAgfQoJICB9KQoJICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYmFja1NuIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbigpewoJICAJY29uc29sZS5sb2coImVudHJlIikKCSAgCQoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZSA9IGluaXQoKVs0OV07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJICB9KQoJICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiYnV5Tm93U24iKS5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkgIAljb25zb2xlLmxvZygiZW50cmUiKQoJICAJbGV0IGdvdG9OZXdPZmZsaW5lUGFnZSA9IGluaXQoKVs1MV07CgkgICAgaWYgKGdvdG9OZXdPZmZsaW5lUGFnZSkgewoJICAgICAgZ290b05ld09mZmxpbmVQYWdlKCk7CgkgICAgfQoJICB9KQoJfSh7CgkgICJiYWNrIiA6IDQ5LAoJICAiZW5hYmxlRGlzYWJsZSIgOiAxODgsCgkgICJ0ZWNoIiA6IDg0LAoJICAibGlzdHMiIDogewoJICAgICJ1cCIgOiAzOCwKCSAgICAiZG93biIgOiA0MCwKCSAgICAicHJldiIgOiAzNywKCSAgICAibmV4dCIgOiAzOQoJICB9LAoJICAic2VhcmNoIiA6IHsKCSAgICAiZGVjTWluQmlkIiA6IDM3LAoJICAgICJpbmNNaW5CaWQiIDogMzksCgkgICAgImRlY01heEJpZCIgOiAzNSwKCSAgICAiaW5jTWF4QmlkIiA6IDM2LAoJICAgICJkZWNNaW5CdXkiIDogNDYsCgkgICAgImluY01pbkJ1eSIgOiAzNCwKCSAgICAiZGVjTWF4QnV5IiA6IDQwLAoJICAgICJpbmNNYXhCdXkiIDogMzgsCgkgICAgInNlYXJjaCIgOiA1MAoJICB9LAoJICAicmVzdWx0cyIgOiB7CgkgICAgImJpZCIgOiA1MiwKCSAgICAiYnV5IiA6IDUxLAoJICAgICJ0cmFuc2ZlciIgOiA4MiwKCSAgICAiY2x1YiIgOiA2NywKCSAgICAicHJlc3NFbnRlciIgOiB0cnVlLAoJICAgICJhdXRvQnV5IiA6IGZhbHNlLAoJICAgICJwcmV2ZW50QmFjayIgOiB0cnVlLAoJICAgICJzZWxsIiA6IDgxLAoJICAgICJkZWNCaWQiIDogNDYsCgkgICAgImluY0JpZCIgOiAzNAoJICB9Cgl9KTsKCgoKCgoKCgpVVE1hcmtldFNlYXJjaFJlc3VsdHNWaWV3Q29udHJvbGxlci5wcm90b3R5cGUuX3JlcXVlc3RJdGVtcyA9IGZ1bmN0aW9uIF9yZXF1ZXN0SXRlbXMobCkgewogICAgdGhpcy5fcGFnaW5hdGlvblZpZXdNb2RlbC5zdG9wQXVjdGlvblVwZGF0ZXMoKTsKICAgIGlmKHRoaXMuX3NlYXJjaENyaXRlcmlhLl90eXBlID09ICJwbGF5ZXIiKXsKICAgICAgICB2YXIgY29udGV4dCA9IHRoaXM7CgogICAgICAgIHJlcXVlc3RJdGVtcygpCiAgICB9IGVsc2UgewogICAgICAgIHNlcnZpY2VzLkl0ZW0uc2VhcmNoVHJhbnNmZXJNYXJrZXQodGhpcy5fc2VhcmNoQ3JpdGVyaWEsIGwpLm9ic2VydmUodGhpcywgZnVuY3Rpb24gX29uUmVxdWVzdEl0ZW1zQ29tcGxldGUoZSwgdCkgewogICAgICAgICAgICBpZiAoZS51bm9ic2VydmUodGhpcyksCiAgICAgICAgICAgICF0LnN1Y2Nlc3MpCiAgICAgICAgICAgICAgICByZXR1cm4gTmV0d29ya0Vycm9yTWFuYWdlci5jaGVja0NyaXRpY2FsU3RhdHVzKHQuc3RhdHVzKSA/IHZvaWQgTmV0d29ya0Vycm9yTWFuYWdlci5oYW5kbGVTdGF0dXModC5zdGF0dXMpIDogKHNlcnZpY2VzLk5vdGlmaWNhdGlvbi5xdWV1ZShbc2VydmljZXMuTG9jYWxpemF0aW9uLmxvY2FsaXplKCJwb3B1cC5lcnJvci5zZWFyY2hlcnJvciIpLCBlbnVtcy5VSU5vdGlmaWNhdGlvblR5cGUuTkVHQVRJVkVdKSwKICAgICAgICAgICAgICAgIHZvaWQgdGhpcy5nZXROYXZpZ2F0aW9uQ29udHJvbGxlcigpLnBvcFZpZXdDb250cm9sbGVyKCkpOwogICAgICAgICAgICBpZiAoMCA8IHRoaXMuX3NlYXJjaENyaXRlcmlhLm9mZnNldCAmJiAwID09PSB0LmRhdGEuaXRlbXMubGVuZ3RoKQogICAgICAgICAgICAgICAgdGhpcy5fcmVxdWVzdEl0ZW1zKGwgLSAxKTsKICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuX3BhZ2luYXRpb25WaWV3TW9kZWwuZ2V0TnVtSXRlbXNQZXJQYWdlKCkKICAgICAgICAgICAgICAgIHZhciBvID0gdC5kYXRhLml0ZW1zLnNsaWNlKCk7CiAgICAgICAgICAgICAgICBzZXRJdGVtcyh0aGlzLG8saSx0LmRhdGEuaXRlbXMpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5fcGFnaW5hdGlvblZpZXdNb2RlbC5zdGFydEF1Y3Rpb25VcGRhdGVzKCkKICAgICAgICB9KQogICAgfQoKICAgIGZ1bmN0aW9uIHVwZGF0ZShkYXRhLGNvbnRleHQpIHsKICAgICAgICBVVEl0ZW1FbnRpdHlGYWN0b3J5LnByb3RvdHlwZS5hdWN0aW9uRmFjdG9yeSA9IG5ldyBVVEF1Y3Rpb25FbnRpdHlGYWN0b3J5KCkKICAgICAgICB2YXIgaSA9IGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuZ2V0TnVtSXRlbXNQZXJQYWdlKCkKICAgICAgICB2YXIgbyA9IFVUSXRlbUVudGl0eUZhY3RvcnkucHJvdG90eXBlLmdlbmVyYXRlSXRlbXNGcm9tQXVjdGlvbkRhdGEoZGF0YS5hdWN0aW9uSW5mbykKICAgICAgICBpZiAoMCA8IGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm9mZnNldCAmJiAwID09PSBkYXRhLmF1Y3Rpb25JbmZvLmxlbmd0aCkKICAgICAgICAgICAgICAgIGNvbnRleHQuX3JlcXVlc3RJdGVtcyhsIC0gMSk7CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgc2V0SXRlbXMoY29udGV4dCxvLGksZGF0YS5hdWN0aW9uSW5mbykKICAgICAgICB9CiAgICAgICAgY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5zdGFydEF1Y3Rpb25VcGRhdGVzKCkgICAKICAgIH0KCiAgICBmdW5jdGlvbiBhZGRGaWx0ZXJzKGNvbnRleHQsdXJsKXsKICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5yYXJpdGllcy5sZW5ndGg+MCl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImcmFyaXR5SWRzPSIrY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEucmFyaXRpZXNbMF0gICAgCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm5hdGlvbiE9LTEpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJm5hdD0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5uYXRpb24KICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubGV2ZWwhPSJhbnkiKXsKICAgICAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubGV2ZWwgPT0gIlNQIil7CiAgICAgICAgICAgICAgICB1cmwgPSB1cmwgKyAiJnJhcmU9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubGV2ZWwKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHVybCA9IHVybCArICImbGV2PSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLmxldmVsCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEuY2x1YiE9LTEpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJnRlYW09IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEuY2x1YgogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5fem9uZSE9LTEpewogICAgICAgICAgICB2YXIgem9uZXMgPSB7CiAgICAgICAgICAgICAgICAiMTMwIjogImRlZmVuc2UiLAogICAgICAgICAgICAgICAgIjEzMSI6ICJtaWRmaWVsZCIsCiAgICAgICAgICAgICAgICAiMTMyIjogImF0dGFja2VyIiAKICAgICAgICAgICAgfQogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJnpvbmU9Iisgem9uZXNbY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEuX3pvbmVdCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnBvc2l0aW9uIT0iYW55Iil7CiAgICAgICAgICAgIHVybCA9IHVybCArICImcG9zPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnBvc2l0aW9uCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1hc2tlZERlZklkKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZtYXNrZWREZWZJZD0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5tYXNrZWREZWZJZAogICAgICAgIH0gICAgCiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubGVhZ3VlIT0tMSl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbGVhZz0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5sZWFndWUKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEucGxheVN0eWxlIT0tMSl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImcGxheVN0eWxlPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLnBsYXlTdHlsZQogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5taW5CdXkpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJm1pbmI9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWluQnV5CiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1heEJ1eSl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbWF4Yj0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5tYXhCdXkKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWluQmlkKXsKICAgICAgICAgICAgdXJsID0gdXJsICsgIiZtaWNyPSIrIGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1pbkJpZAogICAgICAgIH0KICAgICAgICBpZihjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5taW5CaWQpewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJm1pY3I9IisgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEubWluQmlkCiAgICAgICAgfQogICAgICAgIGlmKGNvbnRleHQuX3NlYXJjaENyaXRlcmlhLm1heEJpZCl7CiAgICAgICAgICAgIHVybCA9IHVybCArICImbWFjcj0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5tYXhCaWQKICAgICAgICB9CiAgICAgICAgaWYoY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEuZGVmSWQubGVuZ3RoPjApewogICAgICAgICAgICB1cmwgPSB1cmwgKyAiJmRlZmluaXRpb25JZD0iKyBjb250ZXh0Ll9zZWFyY2hDcml0ZXJpYS5kZWZJZFswXQogICAgICAgIH0KICAgICAgICByZXR1cm4gdXJsCiAgICB9CgogICAgZnVuY3Rpb24gcmVxdWVzdEl0ZW1zKCl7CiAgICAgICAgdmFyIHVybCA9IGAke3NlcnZpY2VzLkF1dGhlbnRpY2F0aW9uLnNlc3Npb25VdGFzLnVybH0vdXQvZ2FtZS9maWZhMjEvdHJhbnNmZXJtYXJrZXQ/bnVtPTIxJnN0YXJ0PSR7KGwtMSkqMjB9JnR5cGU9cGxheWVyYDsKICAgICAgICB1cmwgPSBhZGRGaWx0ZXJzKGNvbnRleHQsdXJsKQogICAgICAgIGZldGNoKHVybCwgewogICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICJYLVVULVNJRCI6IHNlcnZpY2VzLkF1dGhlbnRpY2F0aW9uLmdldFV0YXNTZXNzaW9uKClbImlkIl0KICAgICAgICB9fSkudGhlbihmdW5jdGlvbihyZXNwb25zZSkgewogICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oZGF0YSkgewogICAgICAgICAgICB1cGRhdGUoZGF0YSxjb250ZXh0KSAgICAgICAgICAgICAKICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvcil7CiAgICAgICAgICAgIHNlcnZpY2VzLk5vdGlmaWNhdGlvbi5xdWV1ZShbc2VydmljZXMuTG9jYWxpemF0aW9uLmxvY2FsaXplKCJwb3B1cC5lcnJvci5zZWFyY2hlcnJvciIpLGVudW1zLlVJTm90aWZpY2F0aW9uVHlwZS5ORUdBVElWRV0pCiAgICAgICAgICAgIHZvaWQgY29udGV4dC5nZXROYXZpZ2F0aW9uQ29udHJvbGxlcigpLnBvcFZpZXdDb250cm9sbGVyKCk7CiAgICAgICAgfSkKICAgIH0KCiAgICBmdW5jdGlvbiBzZXRJdGVtcyhjb250ZXh0LG8saSxyZXNwb25zZUl0ZW1zKXsKICAgICAgICBpZiAoY29udGV4dC5vbkRhdGFDaGFuZ2Uubm90aWZ5KHsKICAgICAgICAgICAgaXRlbXM6IG8KICAgICAgICB9KSwKICAgICAgICBvLmxlbmd0aCA+IGkgJiYgKG8gPSBvLnNsaWNlKDAsIGkpKSwKICAgICAgICBjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLnNldFBhZ2VJdGVtcyhvKSwKICAgICAgICBjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLnNldFBhZ2VJbmRleChsKSwKICAgICAgICBjb250ZXh0Ll9zZWxlY3RlZEl0ZW0gJiYgMCA8IG8ubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBuID0gY29udGV4dC5fcGFnaW5hdGlvblZpZXdNb2RlbC5nZXRJbmRleEJ5SXRlbUlkKGNvbnRleHQuX3NlbGVjdGVkSXRlbS5pZCk7CiAgICAgICAgICAgIDAgPCBuICYmIGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuc2V0SW5kZXgobiksCiAgICAgICAgICAgIGNvbnRleHQuX3NlbGVjdGVkSXRlbSA9IG51bGwKICAgICAgICB9CiAgICAgICAgdmFyIHMgPSBjb250ZXh0LmdldFZpZXcoKQogICAgICAgICAgLCByID0gbnVsbDsKICAgICAgICBpZiAoIWNvbnRleHQuX3N0YWRpdW1WaWV3bW9kZWwgfHwgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEudHlwZSAhPT0gU2VhcmNoVHlwZS5WQU5JVFkgJiYgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEudHlwZSAhPT0gU2VhcmNoVHlwZS5DTFVCX0lORk8gJiYgY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEudHlwZSAhPT0gU2VhcmNoVHlwZS5CQUxMIHx8IChyID0gY29udGV4dC5fc3RhZGl1bVZpZXdtb2RlbC5nZXRTdGFkaXVtUHJvZ3Jlc3Npb24oY29udGV4dC5fc2VhcmNoQ3JpdGVyaWEuc3VidHlwZXMpKSwKICAgICAgICBzLnNldEl0ZW1zKGNvbnRleHQuX3BhZ2luYXRpb25WaWV3TW9kZWwuZ2V0Q3VycmVudFBhZ2VJdGVtcygpLCByKSwKICAgICAgICBzLnNldFBhZ2luYXRpb25TdGF0ZSgxIDwgbCwgcmVzcG9uc2VJdGVtcy5sZW5ndGggPiBpKSwKICAgICAgICBKU1V0aWxzLmlzVmFsaWQoY29udGV4dC5fY29tcGFyZUl0ZW0pICYmICFjb250ZXh0Ll9zcXVhZENvbnRleHQpIHsKICAgICAgICAgICAgdmFyIGEgPSBKU1V0aWxzLmZpbmQobywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGUuZ2V0QXVjdGlvbkRhdGEoKS50cmFkZUlkID09PSBjb250ZXh0Ll9jb21wYXJlSXRlbS5nZXRBdWN0aW9uRGF0YSgpLnRyYWRlSWQKICAgICAgICAgICAgfQogICAgICAgICAgICAuYmluZChjb250ZXh0KSk7CiAgICAgICAgICAgIEpTVXRpbHMuaXNWYWxpZChhKSA/IGNvbnRleHQuX3Bpbm5lZExpc3RJdGVtLnNldEl0ZW0oYSkgOiBjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLnNldFBpbm5lZEl0ZW0oY29udGV4dC5fY29tcGFyZUl0ZW0pCiAgICAgICAgfSBlbHNlCiAgICAgICAgICAgICFpc1Bob25lKCkgJiYgMCA8IG8ubGVuZ3RoICYmIHMuc2VsZWN0TGlzdFJvdyhjb250ZXh0Ll9wYWdpbmF0aW9uVmlld01vZGVsLmdldEN1cnJlbnRJdGVtKCkuaWQpCiAgICB9Cn0KCgphY2Nlc3NvYmplY3RzLkNsdWIuZ2V0VXJsUGFyYW1zID0gZnVuY3Rpb24oc2VhcmNoQ3JpdGVyaWEpIHsKICAgIHZhciBjcml0ZXJpYSA9IHt9OwogICAgY3JpdGVyaWEudHlwZSA9IHNlYXJjaENyaXRlcmlhLnR5cGUgPT09IFNlYXJjaFR5cGUuQU5ZID8gU2VhcmNoVHlwZS5QTEFZRVIgOiBzZWFyY2hDcml0ZXJpYS50eXBlLAogICAgY3JpdGVyaWEuc3RhcnQgPSBzZWFyY2hDcml0ZXJpYS5vZmZzZXQsCiAgICBjcml0ZXJpYS5jb3VudCA9IHNlYXJjaENyaXRlcmlhLmNvdW50OwogICAgdmFyIGZvcm1lZENyaXRlcmlhID0gY3JpdGVyaWE7CiAgICBzZWFyY2hDcml0ZXJpYS5zb3J0QnkgPT09IFNlYXJjaFNvcnRUeXBlLlJFQ0VOQ1kgPyBmb3JtZWRDcml0ZXJpYS5hY3F1aXJlZERhdGUgPSBzZWFyY2hDcml0ZXJpYS5zb3J0IDogKGZvcm1lZENyaXRlcmlhLnNvcnQgPSBzZWFyY2hDcml0ZXJpYS5zb3J0LAogICAgZm9ybWVkQ3JpdGVyaWEuc29ydCAhPT0gU2VhcmNoU29ydE9yZGVyLk5PTkUgJiYgKGZvcm1lZENyaXRlcmlhLnNvcnRCeSA9IHNlYXJjaENyaXRlcmlhLnNvcnRCeSkpOwogICAgaWYgKHNlYXJjaENyaXRlcmlhLnR5cGUgPT09IFNlYXJjaFR5cGUuVkFOSVRZKQogICAgICAgIGZvcm1lZENyaXRlcmlhLnZhbml0eVN1YlR5cGVJZHMgPSBzZWFyY2hDcml0ZXJpYS5zdWJ0eXBlczsKICAgIGVsc2UKICAgICAgICBzZWFyY2hDcml0ZXJpYS5jYXRlZ29yeSAhPT0gU2VhcmNoQ2F0ZWdvcnkuQU5ZICYmIChmb3JtZWRDcml0ZXJpYS50eXBlID0gc2VhcmNoQ3JpdGVyaWEuY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSk7CiAgICBpZiAoc2VhcmNoQ3JpdGVyaWEucmFyaXRpZXMubGVuZ3RoID4gMCkKICAgICAgICBmb3JtZWRDcml0ZXJpYS5yYXJpdHlJZHMgPSBzZWFyY2hDcml0ZXJpYS5yYXJpdGllcy5qb2luKCcsJyk7CiAgICBpZiAoc2VhcmNoQ3JpdGVyaWEubGV2ZWwgPT09IGVudW1zLlNlYXJjaExldmVsLlNQRUNJQUwpCiAgICAgICAgZm9ybWVkQ3JpdGVyaWEucmFyZSA9IHNlYXJjaENyaXRlcmlhLmxldmVsOwogICAgZWxzZQogICAgICAgIHNlYXJjaENyaXRlcmlhLmxldmVsICE9PSBlbnVtcy5TZWFyY2hMZXZlbC5BTlkgJiYgKGZvcm1lZENyaXRlcmlhLmxldmVsID0gc2VhcmNoQ3JpdGVyaWEubGV2ZWwpOwogICAgc2VhcmNoQ3JpdGVyaWEuY2x1YiA+IDAgJiYgKGZvcm1lZENyaXRlcmlhLnRlYW0gPSBzZWFyY2hDcml0ZXJpYS5jbHViKTsKICAgIHNlYXJjaENyaXRlcmlhLmxlYWd1ZSA+IDAgJiYgKGZvcm1lZENyaXRlcmlhLmxlYWd1ZSA9IHNlYXJjaENyaXRlcmlhLmxlYWd1ZSk7CiAgICBzZWFyY2hDcml0ZXJpYS5uYXRpb24gPiAwICYmIChmb3JtZWRDcml0ZXJpYS5uYXRpb24gPSBzZWFyY2hDcml0ZXJpYS5uYXRpb24pOwogICAgc2VhcmNoQ3JpdGVyaWEudW50cmFkZWFibGVzICE9PSBlbnVtcy5TZWFyY2hVbnRyYWRlYWJsZXMuREVGQVVMVCAmJiAoZm9ybWVkQ3JpdGVyaWEuaXNVbnRyYWRlYWJsZSA9IHNlYXJjaENyaXRlcmlhLnVudHJhZGVhYmxlcyk7CiAgICBzZWFyY2hDcml0ZXJpYS5leGNsdWRlRGVmSWRzLmxlbmd0aCA+IDAgJiYgKGZvcm1lZENyaXRlcmlhLmV4Y2xkZWYgPSBzZWFyY2hDcml0ZXJpYS5leGNsdWRlRGVmSWRzLmpvaW4oJywnKSk7CiAgICBzZWFyY2hDcml0ZXJpYS5pc0V4YWN0U2VhcmNoICYmIChmb3JtZWRDcml0ZXJpYS5maWx0ZXIgPSAiZXhhY3QiKTsKICAgIGlmIChzZWFyY2hDcml0ZXJpYS56b25lICE9PSAtMSkKICAgICAgICBzd2l0Y2ggKHNlYXJjaENyaXRlcmlhLnpvbmUpIHsKICAgICAgICBjYXNlIFpPTkVfREVGRU5ERVJfVkFMVUU6CiAgICAgICAgICAgIGZvcm1lZENyaXRlcmlhWyJ0eXBlIl0gPSAicGxheWVyZGVmZW5kZXIiOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFpPTkVfTUlERklFTERFUl9WQUxVRToKICAgICAgICAgICAgZm9ybWVkQ3JpdGVyaWFbInR5cGUiXSA9ICJwbGF5ZXJtaWRmaWVsZGVyIjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBaT05FX0FUVEFDS0VSX1ZBTFVFOgogICAgICAgICAgICBmb3JtZWRDcml0ZXJpYVsidHlwZSJdID0gInBsYXllcmZvcndhcmQiOwogICAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIFpPTkVfTk9fR0tfVkFMVUU6CiAgICAgICAgICAgIGZvcm1lZENyaXRlcmlhWyJ0eXBlIl0gPSAicGxheWVybm9uR0siOwogICAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBEZWJ1Z1V0aWxzLkFzc2VydCghW10sICJVbnN1cHBvcnRlZCB6b25lIElEIGluIGNsdWIgc2VhcmNoLiIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICBlbHNlCiAgICAgICAgc2VhcmNoQ3JpdGVyaWEucG9zaXRpb24gIT09IFNlYXJjaFR5cGVbIkFOWSJdICYmIChmb3JtZWRDcml0ZXJpYS5wb3NpdGlvbiA9IHNlYXJjaENyaXRlcmlhLnBvc2l0aW9uKTsKICAgIHJldHVybiBzZWFyY2hDcml0ZXJpYS5wbGF5U3R5bGUgPiAwICYmIChmb3JtZWRDcml0ZXJpYS5wbGF5U3R5bGUgPSBzZWFyY2hDcml0ZXJpYS5wbGF5U3R5bGUpLAogICAgc2VhcmNoQ3JpdGVyaWEuaGFzVmFsaWREZWZJZCgpICYmIChmb3JtZWRDcml0ZXJpYS5kZWZJZCA9IHNlYXJjaENyaXRlcmlhLmRlZklkLmpvaW4oJywnKSksCiAgICBmb3JtZWRDcml0ZXJpYTsKfQ=='))
